# Fast Codebase Assessment - Lightweight structural analysis
# Produces initial overview in seconds/minutes instead of hours
# For deep analysis with commit/PR tracking, use codebase_assess.toml

id = "codebase_assess_fast"
name = "Fast Codebase Assessment"
type = "custom"
description = "Quick codebase analysis using structure/metadata only (no full content import)"
tags = ["assessment", "fast", "structure"]
timeout = "30m"
enabled = true
auto_start = false

# PHASE 1: BUILD CODE MAP (Fast - seconds)
# Creates lightweight documents with metadata only:
# - Directory structure, file counts, LOC
# - Languages detected, exports/imports parsed
# - No full file content stored

[step.code_map]
type = "code_map"
description = "Build hierarchical code structure map"
project_name = "codebase"
dir_path = "."
max_depth = 15
skip_summarization = true

# PHASE 2: GENERATE OUTPUTS (Uses code_map data only)
# Each summary step filters by source_type="code_map" to use structure data

[step.generate_overview]
type = "summary"
description = "Generate codebase overview and architecture summary"
depends = "code_map"
filter_tags = ["codebase"]
filter_limit = 100
api_key = "{google_gemini_api_key}"
output_tags = ["codebase-overview"]
prompt = """Analyze this codebase structure and create a comprehensive OVERVIEW:

## 1. PROJECT SUMMARY
- What does this project do? (2-3 sentences based on directory structure)
- Primary programming language(s) detected
- Estimated project size (LOC, file count)

## 2. ARCHITECTURE
- Key directories and their purposes
- Identified patterns (MVC, microservices, monolith, etc.)
- Component relationships (based on directory structure)

## 3. ENTRY POINTS
- Main application entry points (main.*, index.*, etc.)
- API/HTTP entry points if visible
- CLI entry points if visible

## 4. OPERATIONAL REQUIREMENTS
- Build system indicators (Makefile, package.json, go.mod, Cargo.toml, etc.)
- Configuration patterns (config/, .env, yaml files)
- Docker/container indicators
- CI/CD indicators (.github/, .gitlab-ci.yml, etc.)

## 5. KEY FILES TO UNDERSTAND
- List the 10 most important files to read first
- Explain why each is important

## 6. DEVELOPMENT SETUP (if determinable)
- Likely build commands
- Likely test commands
- Dependencies management approach

Focus on STRUCTURAL analysis from the code map. Be specific about file paths and directory names."""

[step.generate_index]
type = "summary"
description = "Generate searchable codebase index"
depends = "code_map"
filter_tags = ["codebase"]
filter_limit = 200
api_key = "{google_gemini_api_key}"
output_tags = ["codebase-index"]
prompt = """Create a searchable INDEX of this codebase structure:

## Directory Index
For each major directory, list:
- Directory path
- Purpose (inferred from name and contents)
- Key subdirectories
- Notable files

## File Type Summary
Group files by type:
- Source code files (.go, .ts, .py, etc.)
- Configuration files (.toml, .yaml, .json, etc.)
- Documentation files (.md, .txt, etc.)
- Build files (Makefile, Dockerfile, etc.)

## Language Distribution
- Primary language and percentage
- Secondary languages
- LOC breakdown

## Notable Patterns
- Test file patterns (*_test.go, *.spec.ts, etc.)
- Generated file patterns
- Vendor/dependency patterns

Make this index searchable - include specific paths and file names."""

[step.generate_map]
type = "summary"
description = "Generate visual codebase map"
depends = "code_map"
filter_tags = ["codebase"]
filter_limit = 100
api_key = "{google_gemini_api_key}"
output_tags = ["codebase-map"]
prompt = """Create a structural MAP of this codebase:

## 1. DIRECTORY TREE (annotated)
Show the top-level directory structure with purpose annotations:
```
project/
├── cmd/           # CLI entry points
├── internal/      # Private application code
├── pkg/           # Public libraries
├── api/           # API definitions
├── web/           # Frontend code
└── ...
```

## 2. COMPONENT DIAGRAM (ASCII)
Show major components and their relationships:
```
┌─────────┐     ┌─────────┐
│   CLI   │────▶│  Core   │
└─────────┘     └─────────┘
                     │
                     ▼
               ┌─────────┐
               │ Storage │
               └─────────┘
```

## 3. DATA FLOW
Describe how data flows through the system based on structure.

## 4. EXTENSION POINTS
Where would new features be added?
- New commands: cmd/
- New services: internal/services/
- New APIs: api/
- etc.

Use ASCII diagrams where helpful. Be specific about actual directory names."""

[error_tolerance]
max_child_failures = 10
failure_action = "continue"
