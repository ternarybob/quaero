# Competitor Watchlist
# =========================================================================
# Analyzes competitors for a watchlist of stocks using AI and emails
# a proforma summary with links to each report in Quaero.
#
# WORKFLOW:
# 1. Analyze Competitors: For each ticker, identify and fetch competitor data
# 2. Email Report: Send proforma email listing documents with Quaero links
#
# TICKERS: EXR, GNP, SKS, TWR
# OUTPUT TAG: competitor-analysis
# =========================================================================

# =========================================================================
# Job Definition (MUST be at root level before any [section])
# =========================================================================
id = "competitor-watchlist"
name = "Competitor Analysis Watchlist"
type = "orchestrator"
description = "Analyzes ASX-listed competitors for watchlist stocks"
tags = ["competitor", "watchlist", "email"]
schedule = ""
timeout = "2h"
enabled = true
auto_start = false

# =========================================================================
# META (documentation only, not parsed)
# =========================================================================
[meta]
author = "Quaero"
version = "1.0"
created = "2026-01-07"
updated = "2026-01-07"
purpose = "Competitor analysis report for watchlist stocks"

# =========================================================================
# User Configuration - Ticker List
# =========================================================================

[config]
# Ticker list - add/remove as needed
variables = [
    { ticker = "EXR" },
    { ticker = "GNP" },
    { ticker = "SKS" },
    { ticker = "TWR" },
]

# =========================================================================
# Step 1: Analyze Competitors (per ticker)
# =========================================================================
# Uses AI to identify competitors and fetches their stock data
# Creates documents tagged ['competitor-analysis', '<ticker>']
# Requires Gemini API key

[step.analyze_competitors]
type = "market_competitor"
description = "Identify and analyze competitors for each watchlist stock"
on_error = "continue"
api_key = "{google_gemini_api_key}"
period = "Y1"
output_tags = ["format_output"]  # next step name

# =========================================================================
# Step 2: Format Output
# =========================================================================
# Prepares output document for email delivery
# Collects documents by input_tags, formats with email instructions
# Options:
#   format = "inline|pdf|html|markdown" (default: inline)
#   attachment = true|false (default: false)
#   style = "proforma|body" (default: body)
#   order = "ticker|created_at" (default: ticker)

[step.format_output]
type = "output_formatter"
description = "Format competitor analysis summaries for email"
depends = "analyze_competitors"
on_error = "fail"
# input_tags defaults to ["format_output"] (step name)
output_tags = ["email_report"]  # next step name
title = "Competitor Analysis - Watchlist Summary"
style = "body"           # Merge document content (not table listing)
order = "ticker"         # Order by ticker alphabetically (EXR, GNP, SKS, TWR)
# format = "inline"     # default: inline (markdown converted to HTML in body)
# attachment = false    # default: no attachments

# =========================================================================
# Step 3: Email Report
# =========================================================================
# Sends email based on output_formatter document instructions
# Reads format, attachment, style from output_formatter document frontmatter

[step.email_report]
type = "email"
description = "Email competitor analysis report"
depends = "format_output"
always_run = true
on_error = "fail"
to = "bobmcallan@gmail.com"
subject = "Competitor Analysis - Watchlist Summary"
# input_tags defaults to ["email_report"] (step name)
