# Fundamentals Watchlist
# =========================================================================
# Fetches stock fundamentals for a watchlist of stocks and emails
# a proforma summary with links to each report in Quaero.
#
# WORKFLOW:
# 1. Fetch Fundamentals: For each ticker, fetch comprehensive stock data
# 2. Email Report: Send proforma email listing documents with Quaero links
#
# TICKERS: EXR, GNP, SKS, TWR
# OUTPUT TAG: asx-stock-data
# =========================================================================

# =========================================================================
# Job Definition (MUST be at root level before any [section])
# =========================================================================
id = "fundamentals-watchlist"
name = "Fundamentals Watchlist"
type = "orchestrator"
description = "Fetches stock fundamentals for watchlist stocks"
tags = ["fundamentals", "watchlist", "email"]
schedule = ""
timeout = "1h"
enabled = true
auto_start = false

# =========================================================================
# META (documentation only, not parsed)
# =========================================================================
[meta]
author = "Quaero"
version = "1.0"
created = "2026-01-07"
updated = "2026-01-07"
purpose = "Stock fundamentals report for watchlist stocks"

# =========================================================================
# User Configuration - Ticker List
# =========================================================================

[config]
# Ticker list - add/remove as needed
variables = [
    { ticker = "EXR" },
    { ticker = "GNP" },
    { ticker = "SKS" },
    { ticker = "TWR" },
]

# =========================================================================
# Step 1: Fetch Fundamentals (per ticker)
# =========================================================================
# Fetches comprehensive stock data using MarketFundamentalsWorker
# Creates documents tagged ['asx-stock-data', '<ticker>']

[step.fetch_fundamentals]
type = "market_fundamentals"
description = "Fetch stock fundamentals for each watchlist stock"
on_error = "continue"
period = "Y2"

# =========================================================================
# Step 2: Email Report
# =========================================================================
# Sends proforma email with document links (not full content)
# Documents are listed with links to view in Quaero

[step.email_report]
type = "email"
description = "Email fundamentals report with document links"
depends = "fetch_fundamentals"
always_run = true
on_error = "fail"
to = "bobmcallan@gmail.com"
subject = "ASX Fundamentals - Watchlist Summary"
style = "proforma"
list_tags = ["asx-stock-data"]
base_url = "http://localhost:8085"
