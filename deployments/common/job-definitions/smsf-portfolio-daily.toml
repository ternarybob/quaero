# SMSF Aggressive Portfolio Review - Daily Analysis Job
# ===========================================================================
# This job orchestrates the SMSF Portfolio Review for an aggressive SMSF
# portfolio. It runs individual stock analyses using the smsf-portfolio-review
# template, then consolidates all results into a single portfolio review with
# BUY|SELL|HOLD recommendations and SMSF compliance notes.
#
# STRATEGY: Aggressive 100% Australian Equities
# PERSONA: Senior Investment Strategist specializing in Australian SMSFs
#
# WORKFLOW:
# 1. Run smsf-portfolio-review template for each stock (parallel child jobs)
# 2. Generate consolidated portfolio summary with all stocks compared
# 3. Email single portfolio review to SMSF Investment Committee
# ===========================================================================

id = "smsf-portfolio-daily"
name = "SMSF Aggressive Portfolio Review"
type = "job_template"
description = "Senior Investment Strategist review for aggressive SMSF portfolio - BUY|SELL|HOLD recommendations with conviction scoring"
tags = ["smsf", "aggressive", "asx", "stocks", "daily", "template", "portfolio"]
schedule = ""
timeout = "3h"
enabled = true
auto_start = false

# ===========================================================================
# Step 1: Run Individual Stock Analyses
# ===========================================================================
# Executes the smsf-portfolio-review template for each stock.
# Each stock becomes a child job with its own analysis.
# This step completes when ALL child jobs finish.

[step.run_smsf_analysis]
type = "job_template"
description = "Execute SMSF Portfolio Review template for each configured stock"
on_error = "continue"
template = "smsf-portfolio-review"

# Variables array - each entry creates a separate job from the template
# Available variable keys: ticker, name, industry
# Variable references in template: {stock:ticker}, {stock:name}, {stock:industry}
# Modifiers: {stock:ticker_lower}, {stock:ticker_upper}
variables = [
    # Technology & AI (High Growth)
    { ticker = "ROC", name = "RocketBoots Limited", industry = "AI" },

    # Technology
    # { ticker = "XRO", name = "Xero Limited", industry = "technology" },
    # { ticker = "WTC", name = "WiseTech Global", industry = "technology" },

    # Healthcare (Growth Sector)
    # { ticker = "CSL", name = "CSL Limited", industry = "healthcare" },
    # { ticker = "PME", name = "Pro Medicus", industry = "healthcare" },

    # Resources & Mining (Cyclical Growth)
    # { ticker = "BHP", name = "BHP Group", industry = "mining" },
    # { ticker = "RIO", name = "Rio Tinto", industry = "mining" },
    # { ticker = "FMG", name = "Fortescue Metals", industry = "mining" },
    # { ticker = "LTR", name = "Liontown Resources", industry = "lithium" },

    # Energy (Transition Play)
    # { ticker = "WDS", name = "Woodside Energy", industry = "energy" },
    # { ticker = "STO", name = "Santos Limited", industry = "energy" },

    # Small/Mid Cap Growth
    # { ticker = "LNK", name = "Link Administration", industry = "fintech" },
    # { ticker = "TYR", name = "Tyro Payments", industry = "fintech" },
]

# ===========================================================================
# Step 2: Generate Consolidated Portfolio Summary
# ===========================================================================
# After all individual stock analyses complete, this step reads ALL
# smsf-recommendation documents and creates a portfolio-level view
# with consolidated BUY|SELL|HOLD recommendations.

[step.generate_portfolio_summary]
type = "summary"
description = "Generate consolidated SMSF aggressive portfolio review with all stocks"
depends = "run_smsf_analysis"
on_error = "fail"
filter_tags = ["smsf-recommendation"]
api_key = "{google_gemini_api_key}"
prompt = """You are a Senior Investment Strategist preparing a consolidated SMSF portfolio review for an aggressive, 100% Australian Equities fund.

You have received individual SMSF Portfolio Review reports for multiple ASX stocks. Your task is to consolidate these into a SINGLE portfolio review document.

# SMSF AGGRESSIVE PORTFOLIO REVIEW: CONSOLIDATED ASSESSMENT
## Prepared for: SMSF Investment Committee
## Strategy: Aggressive 100% Australian Equities
## Analysis Date: [Current Date]

---

## EXECUTIVE SUMMARY

**PORTFOLIO HEALTH vs S&P/ASX 200**: [Outperforming / In Line / Underperforming]
**PORTFOLIO HEALTH vs Small Ordinaries**: [Outperforming / In Line / Underperforming]

Based on the individual stock analyses, provide a high-level view of:
- Number of stocks reviewed: X
- Overall portfolio quality score: X/10
- Aggressive strategy alignment: [Strong / Moderate / Weak]

[2-3 sentence summary of portfolio health and key actions required]

---

## STOCK-BY-STOCK RECOMMENDATION TABLE

Consolidate ALL stocks analyzed into this table:

| Ticker | Status (BUY/SELL/HOLD) | Conviction (1-10) | Primary Reason |
|--------|------------------------|-------------------|----------------|
| [XXX] | [BUY/SELL/HOLD] | [1-10] | [One-line reason from individual analysis] |
| ... | ... | ... | ... |

### Conviction Distribution
- High Conviction (7-10): X stocks
- Moderate Conviction (4-6): X stocks
- Low Conviction (1-3): X stocks

---

## THE "WHY": DETAILED JUSTIFICATIONS

### SELL Recommendations (if any)
For each SELL recommendation, provide detailed justification:

**[Ticker] - [Company Name]**
- Conviction: X/10
- Primary Reason: [From individual analysis]
- Exit Strategy: [Immediate / Staged]
- Suggested Replacement: [From alternatives in individual analysis]

### HOLD Recommendations (if any)
For each HOLD recommendation, provide detailed justification:

**[Ticker] - [Company Name]**
- Conviction: X/10
- Reason for Not Selling: [Evidence from analysis]
- Reason for Not Buying More: [Evidence from analysis]
- Review Trigger: [What would change this to BUY or SELL]

---

## ALTERNATIVE REPLACEMENTS

From all individual analyses, consolidate the top 2-3 ASX stocks NOT in the portfolio that offer better risk-adjusted growth:

| Alternative | Ticker | Industry | Why Better | Replaces |
|-------------|--------|----------|------------|----------|
| [Company 1] | [XXX] | [Sector] | [Key advantage] | [Which holding to replace] |
| [Company 2] | [XXX] | [Sector] | [Key advantage] | [Which holding to replace] |
| [Company 3] | [XXX] | [Sector] | [Key advantage] | [General portfolio improvement] |

---

## SECTOR ALLOCATION ANALYSIS

| Sector | # Stocks | Recommendation Distribution | Sector Outlook |
|--------|----------|----------------------------|----------------|
| [Sector] | X | X BUY, X HOLD, X SELL | [Positive/Neutral/Negative] |
| ... | ... | ... | ... |

### Sector Concentration Concerns
- [Identify any over-concentration in specific sectors]
- [Recommendations for rebalancing if needed]

---

## SMSF COMPLIANCE NOTE

### Concentration Risk Assessment
The portfolio currently has:
- **Single Stock Concentration**: [Any stock > 20% of portfolio? Flag here]
- **Sector Concentration**: [Any sector > 40% of portfolio? Flag here]
- **100% Equities Allocation**: Per ATO guidelines, 100% equities is permissible but requires documented justification

### Investment Strategy Alignment
Per ATO requirements, SMSF trustees must ensure investments align with documented Investment Strategy:
- **Risk Tolerance**: Aggressive (100% growth assets) - [Appropriate / Requires Review]
- **Diversification**: [Adequate / Requires Attention]
- **Liquidity**: [Sufficient for member needs / Review required]
- **Insurance Needs**: [Consider life insurance requirements]

### Recommended Actions for Compliance
1. [Action 1 - if any]
2. [Action 2 - if any]

---

## PRIORITY ACTION LIST

### Immediate Actions (Priority 1)
For SELL recommendations with High Conviction:
| Action | Stock | Reason | Target |
|--------|-------|--------|--------|
| SELL | [Ticker] | [Reason] | Exit by [date/price] |

### Near-Term Actions (Priority 2)
For BUY recommendations with High Conviction:
| Action | Stock | Reason | Target |
|--------|-------|--------|--------|
| BUY | [Ticker] | [Reason] | Entry at $X.XX |

### Monitor (Priority 3)
HOLD recommendations and low conviction actions:
| Stock | Watch For | Trigger |
|-------|-----------|---------|
| [Ticker] | [Event] | [What would change recommendation] |

---

## FOLLOW-UP PROTOCOL

This analysis supports the following follow-up queries:
- "Analyze a 20% shift into [Sector X]" - Portfolio rebalancing simulation
- "Stress test this portfolio against a 10% market correction" - Downside scenario
- "Find mid-cap alternatives with higher R&D-to-revenue ratios" - Growth screening

---

## PORTFOLIO RISK SUMMARY

| Risk Category | Level | Mitigation |
|--------------|-------|------------|
| Market Risk | [Low/Med/High] | [Action if High] |
| Sector Concentration | [Low/Med/High] | [Action if High] |
| Single Stock Risk | [Low/Med/High] | [Action if High] |
| Liquidity Risk | [Low/Med/High] | [Action if High] |

**OVERALL PORTFOLIO RISK**: [Low / Moderate / High]

---

## NEXT REVIEW

- **Recommended Review Date**: [4-6 weeks from analysis date]
- **Key Events to Monitor**: [Upcoming earnings, economic events]
- **Trigger for Early Review**: [Market correction > 5%, major company news]

---

**DISCLAIMER**: This portfolio review uses formal financial methodology for SMSF investment decisions.
This is general information only and not personal financial advice.
SMSF trustees should consult licensed advisers for investment decisions.
Constraint: Only ASX-listed stocks considered.
"""
output_tags = ["smsf-portfolio-review", "smsf-portfolio", "portfolio-summary"]

# ===========================================================================
# Step 3: Email Consolidated Portfolio Report
# ===========================================================================
# Sends the single consolidated portfolio review email.

[step.email_portfolio_report]
type = "email"
description = "Email consolidated SMSF aggressive portfolio review"
depends = "generate_portfolio_summary"
on_error = "fail"
to = "bobmcallan@gmail.com"
subject = "SMSF Aggressive Portfolio Review - Consolidated Stock Analysis"
body_from_tag = "smsf-portfolio-review"
