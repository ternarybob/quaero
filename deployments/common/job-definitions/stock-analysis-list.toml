# Stock Analysis - List Output
# =========================================================================
# Analyzes stocks using a user-provided ticker list.
# Outputs a flat LIST of stock analyses - NOT grouped by portfolio.
# For portfolio-level analysis with grouping, use portfolio-analysis.toml
#
# WORKFLOW:
# 1. Data Collection: Deterministic data fetching via StockDataCollectionWorker
# 2. Stock Analysis: AI analysis using embedded stock-analysis template
# 3. Email Report: Send stock analysis list via email
#
# USE CASE: When you want to analyze stocks as independent entities,
# not as part of a portfolio. Output is a list of individual stock reports.
#
# VARIABLES FORMAT:
# - ticker: ASX code (required) - can be "GNP" or "ASX:GNP"
#
# TEMPLATE: internal/templates/stock-analysis.toml (embedded)
# OUTPUT TAG: stock-analysis
# =========================================================================

# =========================================================================
# Job Definition (MUST be at root level before any [section])
# =========================================================================
id = "stock-analysis-list"
name = "Stock Analysis (List)"
type = "orchestrator"
description = "AI-powered stock analysis - outputs a list of stock analyses"
tags = ["stocks", "analysis", "list", "hybrid"]
schedule = ""
timeout = "2h"
enabled = true
auto_start = false

# =========================================================================
# META (documentation only, not parsed)
# =========================================================================
[meta]
author = "Claude Code"
version = "2.0"
created = "2026-01-03"
updated = "2026-01-03"
purpose = "AI-powered stock analysis with hybrid workflow (deterministic data + AI analysis)"

# =========================================================================
# User Configuration - Ticker List
# =========================================================================

[config]
# Ticker list - add/remove as needed
# Stocks are analyzed as a list, NOT grouped by portfolio
variables = [
    { ticker = "ASX:GNP" },
    { ticker = "ASX:BCN" },
    { ticker = "ASX:MYG" },
]

# Benchmark for comparison
benchmarks = [{ code = "XJO", name = "S&P/ASX 200" }]

# =========================================================================
# Step 1: Data Collection (Deterministic)
# =========================================================================
# Collects stock data for all tickers using StockDataCollectionWorker
# Creates documents tagged ['stock-data-collected', '<ticker>']
# This is deterministic - no LLM involved in data collection

[step.collect_data]
type = "market_data_collection"
description = "Collect stock data for all tickers"
on_error = "fail"
output_tags = ["analyze"]  # next step name

# =========================================================================
# Step 2: Stock Analysis (AI)
# =========================================================================
# Analyzes collected data using embedded stock-analysis template
# Creates documents tagged ['stock-analysis']

[step.analyze]
type = "summary"
description = "Analyze collected stock data"
depends = "collect_data"
on_error = "fail"
template = "stock-analysis"
# input_tags defaults to ["analyze"] (step name)
output_tags = ["email_report"]  # next step name

# =========================================================================
# Step 3: Email Report
# =========================================================================
# Sends stock analysis list via email
# Uses documents tagged with ['stock-analysis']

[step.email_report]
type = "email"
description = "Email stock analysis list"
depends = "analyze"
always_run = true
on_error = "fail"
to = "bobmcallan@gmail.com"
subject = "Stock Analysis - List Report"
# input_tags defaults to ["email_report"] (step name)
