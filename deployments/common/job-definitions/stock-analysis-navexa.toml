# Stock Analysis - Navexa Portfolio Source
# =========================================================================
# Analyzes stocks from Navexa portfolio holdings using hybrid workflow.
#
# WORKFLOW:
# 1. Navexa Data: Fetch holdings from Navexa API
# 2. Data Collection: Deterministic stock data fetching
# 3. Stock Analysis: AI analysis using embedded template
# 4. Email Report: Send analysis results
#
# TEMPLATES (embedded):
# - internal/templates/stock-analysis.toml (Step 3)
# OUTPUT TAG: stock-analysis
# =========================================================================

# =========================================================================
# Job Definition (MUST be at root level before any [section])
# =========================================================================
id = "stock-analysis-navexa"
name = "Stock Analysis (Navexa Portfolios)"
type = "orchestrator"
description = "AI-powered stock analysis using Navexa portfolio holdings"
tags = ["stocks", "analysis", "navexa", "portfolio", "hybrid"]
schedule = ""
timeout = "3h"
enabled = true
auto_start = false

# =========================================================================
# META (documentation only, not parsed)
# =========================================================================
[meta]
author = "Claude Code"
version = "4.0"
created = "2026-01-02"
updated = "2026-01-03"
purpose = "Navexa portfolio stock analysis with hybrid workflow"

# =========================================================================
# User Configuration
# =========================================================================

[config]
# Portfolio names to analyze (from Navexa)
# Leave empty [] to analyze ALL portfolios
portfolio_names = ["SMSF"]

# Benchmark for comparison
benchmarks = [{ code = "XJO", name = "S&P/ASX 200" }]

# =========================================================================
# Step 1: Navexa Holdings
# =========================================================================
# Fetches portfolio holdings from Navexa API
# Creates documents tagged with ['navexa-holdings', '<portfolio_name>']

[step.navexa_data]
type = "navexa_holdings"
description = "Fetch Navexa portfolio holdings"
on_error = "fail"
output_tags = ["collect_data"]  # next step name

# =========================================================================
# Step 2: Data Collection (Deterministic)
# =========================================================================
# Collects stock data for tickers from navexa-holdings documents
# Creates documents tagged ['stock-data-collected', '<ticker>']

[step.collect_data]
type = "market_data_collection"
description = "Collect stock data for Navexa holdings"
depends = "navexa_data"
on_error = "fail"
# input_tags defaults to ["collect_data"] (step name)
output_tags = ["analyze"]  # next step name

# =========================================================================
# Step 3: Stock Analysis (AI)
# =========================================================================
# Analyzes collected data using embedded stock-analysis template
# Creates documents tagged ['stock-analysis']

[step.analyze]
type = "summary"
description = "Analyze collected stock data"
depends = "collect_data"
on_error = "fail"
template = "stock-analysis"
# input_tags defaults to ["analyze"] (step name)
output_tags = ["email_report"]  # next step name

# =========================================================================
# Step 4: Email Report
# =========================================================================

[step.email_report]
type = "email"
description = "Email Navexa portfolio analysis report"
depends = "analyze"
always_run = true
on_error = "fail"
to = "bobmcallan@gmail.com"
subject = "Navexa Portfolio Analysis - AI-Powered Report"
# input_tags defaults to ["email_report"] (step name)
