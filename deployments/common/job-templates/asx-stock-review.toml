# ASX Stock Review Job Template
# =========================================================================
# Comprehensive ASX Stock Analysis with Deep Data Collection
# Parallel data collection for speed, deep analysis for quality
#
# FEATURES:
# - Parallel Data Collection: All data steps run simultaneously for speed
# - Deep Analysis: 24 months of data, NOISE vs SIGNAL analysis
# - Technical Analysis: Price action, SMAs, RSI, support/resistance
# - Fundamental Analysis: Announcements, financials, industry outlook
# - Conviction Scoring: 1-10 scale for actionable recommendations
#
# USAGE:
# This template is designed to be invoked via a job_template step with variables:
#   variables = [
#     { ticker = "ROC", name = "RocketBoots Limited", industry = "AI" },
#     { ticker = "XRO", name = "Xero Limited", industry = "technology" }
#   ]
#
# VARIABLE SYNTAX:
# - {stock:ticker} - ASX ticker code (e.g., ROC)
# - {stock:name} - Company name
# - {stock:industry} - Industry classification
# - {stock:ticker_lower} - Lowercase ticker for URLs/tags
# =========================================================================

id = "asx-review-{stock:ticker_lower}"
name = "ASX Stock Review: {stock:ticker}"
type = "stock_analysis"
description = "Comprehensive investment analysis for {stock:name} (ASX:{stock:ticker}) - Deep analysis with parallel data collection"
tags = ["asx", "stock-review", "{stock:ticker_lower}", "{stock:industry}"]
schedule = ""
timeout = "30m"
enabled = true
auto_start = false

# =========================================================================
# PARALLEL DATA COLLECTION PHASE
# =========================================================================
# All data collection steps run in parallel (no depends) for maximum speed.
# Each step produces tagged output for summary steps to consume.

# =========================================================================
# Step 1: Fetch Stock Data (24 Months) - PARALLEL
# =========================================================================
# Comprehensive historical OHLCV data and technical indicators.

[step.fetch_stock_data]
type = "asx_stock_data"
description = "Fetch 24-month daily stock data and technicals for {stock:name}"
on_error = "continue"
asx_code = "{stock:ticker}"
period = "Y2"
output_tags = ["{stock:ticker_lower}", "stock-data", "{stock:industry}"]

# =========================================================================
# Step 2: Fetch Company Announcements (24 Months) - PARALLEL
# =========================================================================
# Official ASX announcements for fundamental analysis and NOISE vs SIGNAL.

[step.fetch_announcements]
type = "asx_announcements"
description = "Fetch ASX announcements for {stock:name} fundamental analysis"
on_error = "continue"
asx_code = "{stock:ticker}"
period = "Y2"
limit = 50
output_tags = ["{stock:ticker_lower}", "announcements", "{stock:industry}"]

# =========================================================================
# Step 3: Search Financial News & Analyst Coverage - PARALLEL
# =========================================================================
# Web search for analyst ratings, financial news, and growth catalysts.

[step.search_financial_news]
type = "web_search"
description = "Search financial news, analyst coverage, and growth catalysts for {stock:name}"
on_error = "continue"
api_key = "{google_gemini_api_key}"
query = """ASX:{stock:ticker} {stock:name}
- financial results earnings revenue profit analyst ratings
- broker recommendations price targets dividend news
- growth catalysts expansion plans market opportunities
site:afr.com OR site:theaustralian.com.au OR site:stockhead.com.au OR site:hotcopper.com.au OR site:marketindex.com.au"""
output_tags = ["{stock:ticker_lower}", "financial-news", "{stock:industry}"]
depth = 3
breadth = 3

# =========================================================================
# Step 4: Search Industry Outlook & Sector Trends - PARALLEL
# =========================================================================
# Research industry outlook and macro factors affecting the sector.

[step.search_industry]
type = "web_search"
description = "Search for {stock:industry} sector industry outlook and trends"
on_error = "continue"
api_key = "{google_gemini_api_key}"
query = """Australian {stock:industry} sector outlook 2025 2026:
- industry trends growth drivers headwinds
- RBA interest rate impact on {stock:industry}
- regulatory environment changes
- market analysis forecast"""
output_tags = ["{stock:ticker_lower}", "industry-outlook", "{stock:industry}"]
depth = 2
breadth = 3

# =========================================================================
# Step 5: Search Competitor Analysis - PARALLEL
# =========================================================================
# Research competitor positioning and relative performance.

[step.search_competitors]
type = "web_search"
description = "Search for {stock:industry} competitor comparison for {stock:name}"
on_error = "continue"
api_key = "{google_gemini_api_key}"
query = """ASX {stock:industry} comparison {stock:name}:
- competitors market share performance 2025
- peer comparison valuation metrics
- competitive advantages disadvantages
- industry leaders disruptors"""
output_tags = ["{stock:ticker_lower}", "competitors", "{stock:industry}"]
depth = 2
breadth = 3

# =========================================================================
# SEQUENTIAL ANALYSIS PHASE
# =========================================================================
# Summary steps run sequentially after all parallel data collection completes.
# Each step builds on the previous analysis.

# =========================================================================
# Step 6: Analyze Announcements - NOISE vs SIGNAL
# =========================================================================
# Critical analysis of announcement quality vs price impact.
# Waits for all parallel steps via depends on last parallel step.

[step.analyze_announcements]
type = "summary"
description = "Analyze announcements against share price movements to identify NOISE vs SIGNAL"
depends = "search_competitors"
on_error = "continue"
filter_tags = ["{stock:ticker_lower}"]
api_key = "{google_gemini_api_key}"
thinking_level = "HIGH"
prompt = """You are a Management Forensic Analyst & Equity Researcher specializing in separating NOISE from SIGNAL in corporate communications and identifying the "Vanishing Promise" and "Pump-to-Hold" ratio.

**COMPANY**: ASX:{stock:ticker} ({stock:name}) - {stock:industry} sector

**YOUR TASK**: Analyze each ASX announcement against the historical share price data to determine if announcements actually moved the stock price or were just PR noise. Additionally, conduct forensic analysis of management credibility and promise delivery.

**INPUT DOCUMENTS**:
1. Stock Data document - Contains historical daily prices and technicals for {stock:ticker}
2. Announcements document - Contains dated announcements with headlines for {stock:ticker}

## REQUIRED ANALYSIS

### ANNOUNCEMENT-PRICE CORRELATION TABLE

For EACH significant announcement, determine if price moved significantly in the 3 days after:

| Date | Announcement | Price Before | Price +3 Days | Change % | Volume Ratio | Classification |
|------|--------------|--------------|---------------|----------|--------------|----------------|
| ... | ... | $... | $... | ...% | X.Xx (vs 30d avg) | SIGNAL/NOISE/LOW-CONVICTION |

**Classification Rules**:
- **SIGNAL** = Price moved >3% AND volume was >1.5x the 30-day average (use 2% threshold for large caps)
- **LOW-CONVICTION SPECULATION** = Price moved >3% BUT volume was <1.5x the 30-day average (move lacks institutional backing)
- **NOISE** = Price moved <3% or moved opposite to announcement sentiment

### PRICE SUSTAINABILITY ANALYSIS

For EVERY "Signal" announcement (>3% move), verify if the price held its gains:

| Date | Announcement | Price +3 Days | Price +5 Days | Held Gains? | Classification |
|------|--------------|---------------|---------------|-------------|----------------|
| ... | ... | $... | $... | Yes/No | SUSTAINABLE / MEAN REVERSION |

**SUSTAINABLE** = Price held gains for 5+ trading days
**MEAN REVERSION (Pump and Fade)** = Price returned to pre-announcement levels within 5 days

**Pump-to-Hold Ratio**: X sustainable / Y total signals = Z%

### SIGNAL ANNOUNCEMENTS (Price Movers)
List announcements that ACTUALLY moved the share price with evidence:
- Date, headline, price change, why it was material

### NOISE ANNOUNCEMENTS (PR Fluff)
List announcements that had NO material price impact despite positive spin:
- Date, headline, expected vs actual price reaction

### RETAIL TRAP FILTER

**Promotional Language Flags**:
Explicitly identify announcements containing these RED FLAG phrases WITHOUT specific KPI backing or audited financial metrics:
- "Transformational" / "Transformative"
- "World-class" / "World-leading"
- "Next-gen" / "Next-generation"
- "Game-changing" / "Disruptive"
- "Strategic" (without quantified value)
- "Significant" (without dollar amounts)
- "Strong pipeline" (without conversion rates)

| Date | Announcement | Promotional Term | KPI Backing? | TRAP/LEGITIMATE |
|------|--------------|------------------|--------------|-----------------|
| ... | ... | ... | Yes/No | TRAP/LEGITIMATE |

**Retail Trap Score**: X trap announcements / Y total announcements with promotional language

### CRITICAL ANALYSIS: PR vs REALITY

**Company Narrative Credibility Score: X/10**

1. **Track Record of Promises vs Delivery**
   - What did management promise in past announcements?
   - Were those targets met? Evidence from subsequent announcements.

2. **Pattern Detection**
   - Does the company frequently announce "significant" deals that don't move the stock?
   - Are announcements timed to coincide with capital raises or insider activity?

3. **Information Quality**
   - Do announcements contain specific metrics or vague language?
   - Are financial impacts quantified or left ambiguous?

4. **Red Flags Identified**
   - Promotional language without substance
   - Frequent "strategic partnership" announcements with no follow-up
   - Management changes with minimal explanation
   - Dilutive capital raises disguised as "growth funding"

### MANAGEMENT CREDIBILITY GAP AUDIT

Compare the "Strategic Outlook" of the current/recent announcement against reports from 6 and 12 months ago:

1. **6-Month Comparison**:
   - What was promised 6 months ago?
   - What has been delivered/omitted?
   - Credibility Gap: [None / Minor / Significant / Critical]

2. **12-Month Comparison**:
   - What was promised 12 months ago?
   - What has been delivered/omitted?
   - Credibility Gap: [None / Minor / Significant / Critical]

### VANISHING PROMISES TABLE

Identify specific targets or milestones mentioned in past announcements that have been omitted, delayed, or renamed:

| Date | Promise Made (6-12 Months Ago) | Current Status | Credibility Impact |
|------|-------------------------------|----------------|-------------------|
| [Date] | [e.g., "Launching in Q4 2024"] | [e.g., "Delayed to 2026 / Omitted / Renamed to..."] | [Critical/Significant/Neutral] |
| ... | ... | ... | ... |

**Vanishing Promise Score**: X broken/delayed promises / Y total promises made = Z%

### INVESTOR INTELLIGENCE SUMMARY

**OVERALL ASSESSMENT**: [CREDIBLE / CAUTIOUS / SKEPTICAL]

- **Signal-to-Noise Ratio**: X signal announcements / Y total announcements = Z%
- **Low-Conviction Speculation**: X announcements (price moved but low volume - lacks institutional conviction)
- **Pump-to-Hold Ratio**: X% (sustainable gains vs mean reversion)
- **Retail Trap Score**: X% (promotional language without substance)
- **Vanishing Promise Score**: X% (broken/delayed promises)
- **Key Takeaway**: [One sentence on whether to trust company announcements]

---
**CRITICAL RULES**:
- Use ONLY prices from the Stock Data document
- If you cannot find price data for an announcement date, state "Price data unavailable - CANNOT VERIFY"
- Be skeptical - assume all announcements are noise until proven otherwise
- Call out promotional language explicitly
- IF YOU DO NOT HAVE DATA, SAY "UNKNOWN" - never fabricate or estimate
- Adjust volatility threshold based on company size (large caps ~2%, small caps ~5%)
- When comparing outlooks, if historical announcement data is limited, state "Insufficient historical data for credibility gap analysis"
- Flag ALL promotional language - even if the underlying business may be legitimate"""
output_tags = ["{stock:ticker_lower}", "announcement-analysis", "{stock:industry}"]

# =========================================================================
# Step 7: Generate Comprehensive Stock Summary
# =========================================================================
# Combines all data into a structured analysis with growth focus.

[step.generate_stock_summary]
type = "summary"
description = "Generate comprehensive stock summary for {stock:name} with growth metrics"
depends = "analyze_announcements"
on_error = "fail"
filter_tags = ["{stock:ticker_lower}"]
api_key = "{google_gemini_api_key}"
thinking_level = "HIGH"
prompt = """You are a Senior Investment Strategist specializing in Australian Self-Managed Super Funds (SMSFs).
Analyze all collected data for ASX:{stock:ticker} ({stock:name}) in the {stock:industry} sector.

## COMPANY OVERVIEW
- Company: {stock:name} (ASX:{stock:ticker})
- Industry: {stock:industry}
- Classification: [Large Cap / Mid Cap / Small Cap / Micro Cap]
- Brief description and business model

## PERFORMANCE CLASSIFICATION
Based on the 12-24 month stock data, classify this holding as:

**LAGGARD** (Underperforming) | **PERFORMING** (Meeting expectations) | **OVER-PERFORMER** (Exceeding expectations)

Justification: [Cite specific metrics from stock data - price change %, RSI, SMA alignment]

## PRICE ACTION ANALYSIS

### Current Position
| Metric | Value | Signal |
|--------|-------|--------|
| Last Price | $ (or "UNAVAILABLE") | |
| vs SMA 20 | Above/Below by $X (X%) | Bullish/Bearish |
| vs SMA 50 | Above/Below by $X (X%) | Bullish/Bearish |
| vs SMA 200 | Above/Below by $X (X%) | Bullish/Bearish |
| RSI (14) | X | Overbought/Oversold/Neutral |
| 52-Week Position | X% (Low $X, High $X) | |

### Technical Verdict
- **Trend**: [Description of current trend with evidence FROM THE DATA]
- **Key Levels**: Support $X, Resistance $X
- **Pattern**: [Any chart patterns identified - or "No clear pattern"]

## FUNDAMENTAL ANALYSIS

### Financial Metrics (from announcements and news)
| Metric | Value | Trend | Signal |
|--------|-------|-------|--------|
| Revenue Growth | % | Accelerating/Stable/Declining | |
| Earnings Growth | % | Accelerating/Stable/Declining | |
| Profit Margins | % | Expanding/Stable/Contracting | |
| Debt Level | | Low/Moderate/High | |
| Cash Position | | Strong/Adequate/Weak | |

### Key Announcements Impact
- Earnings/Dividends: [Impact assessment]
- Leadership Changes: [Impact assessment]
- Strategic Initiatives: [Impact assessment]
- Capital Raising: [Impact assessment]

## ANNOUNCEMENT QUALITY (from NOISE vs SIGNAL analysis)
- **Credibility Score**: X/10
- **Signal-to-Noise Ratio**: X%
- **Management Reliability**: [Assessment]

## INDUSTRY & COMPETITIVE ANALYSIS

### {stock:industry} Sector Outlook
- **Industry Growth Rate**: [Above/At/Below GDP growth]
- **Macro Factors**: [RBA rates, inflation, regulatory environment]
- **Headwinds/Tailwinds**: [Key factors from search data]

### Competitive Positioning
| Competitor | Relative Performance | Threat Level |
|------------|---------------------|--------------|
| [Name] | Outperforming/Matching/Underperforming | High/Medium/Low |

## AGGRESSIVE STRATEGY ALIGNMENT

### Growth Potential Assessment
| Factor | Score (1-5) | Evidence |
|--------|-------------|----------|
| High-Growth Potential | | |
| Capital Appreciation Upside | | |
| Sector Disruption Potential | | |
| Management Execution | | |
| Competitive Moat | | |

**TOTAL AGGRESSIVE FIT SCORE**: X/25

---
IMPORTANT:
- Use ONLY data from the provided documents
- If data unavailable, mark as "N/A" and explain
- Be objective and skeptical of promotional claims"""
output_tags = ["smsf-summary", "{stock:ticker_lower}", "{stock:industry}"]

# =========================================================================
# Step 8: Generate Investment Recommendation
# =========================================================================
# Final BUY/SELL/HOLD with conviction scoring, SMSF compliance,
# trader recommendations, and alternative suggestions.

[step.investment_recommendation]
type = "summary"
description = "Generate BUY/SELL/HOLD recommendation with conviction score for {stock:name}"
depends = "generate_stock_summary"
on_error = "fail"
filter_tags = ["smsf-summary", "{stock:ticker_lower}"]
api_key = "{google_gemini_api_key}"
thinking_level = "HIGH"
prompt = """You are a Senior Investment Strategist specializing in Australian Self-Managed Super Funds (SMSFs).
Generate a formal investment recommendation for ASX:{stock:ticker} ({stock:name}).

# SMSF PORTFOLIO REVIEW: ASX:{stock:ticker}
## Prepared for: SMSF Investment Committee
## Strategy: Aggressive 100% Australian Equities

---

## EXECUTIVE SUMMARY

| Assessment | Rating | Confidence |
|------------|--------|------------|
| Technical Outlook | BULLISH / BEARISH / NEUTRAL | HIGH / MEDIUM / LOW |
| Announcement Credibility | HIGH / MEDIUM / LOW | |
| Signal-to-Noise Ratio | X% | |
| {stock:industry} Sector Outlook | POSITIVE / NEUTRAL / NEGATIVE | |
| Competitive Position | LEADER / STRONG / MODERATE / WEAK | |

---

## RECOMMENDATION TABLE

| Ticker | Status | Conviction (1-10) | Primary Reason |
|--------|--------|-------------------|----------------|
| {stock:ticker} | **[BUY / SELL / HOLD]** | **[1-10]** | [One-line reason] |

### Conviction Scale
- 1-3: Low conviction - high uncertainty
- 4-6: Moderate conviction - balanced factors
- 7-8: High conviction - strong directional view
- 9-10: Very high conviction - exceptional opportunity/risk

---

## DETAILED JUSTIFICATION

### For BUY Recommendation:
- **Growth Catalyst 1**: [Specific evidence]
- **Growth Catalyst 2**: [Specific evidence]
- **Valuation Support**: [Why current price is attractive]
- **Technical Entry**: [Chart-based entry rationale]

### For HOLD Recommendation:
- **Reason for Not Selling**: [Specific evidence]
- **Reason for Not Buying More**: [Why wait]
- **Watch Points**: [What would change recommendation]
- **Expected Holding Period**: [Timeframe]

### For SELL Recommendation:
- **Exit Reason 1**: [Specific concern with evidence]
- **Exit Reason 2**: [Supporting concern]
- **Opportunity Cost**: [Better alternatives exist]
- **Exit Strategy**: [Immediate / Staged]

---

## ACTIONABLE RECOMMENDATIONS

### For Traders (1-4 weeks)
**SIGNAL: BUY / HOLD / SELL / NO TRADE**
- Entry: $X.XX (or "Wait for confirmation")
- Stop Loss: $X.XX (X% below entry)
- Target: $X.XX (X% upside)
- Risk/Reward: X:1
- **CONFIDENCE**: HIGH / MEDIUM / LOW

### For Investors (6-12 months)
**SIGNAL: BUY / HOLD / SELL**
- Accumulate below: $X.XX
- Sell above: $X.XX
- Key catalyst to watch: [Upcoming events/results]

### Dividend Investors (if applicable)
- Current yield: X% (or "N/A")
- Expected yield: X%
- Ex-dividend dates to watch

---

## ALTERNATIVE REPLACEMENTS

If SELL or seeking better risk-adjusted growth, consider these 2-3 ASX stocks:

| Alternative | Ticker | Industry | Why Better | Risk Level |
|-------------|--------|----------|------------|------------|
| [Company 1] | [XXX] | [Sector] | [Advantage over {stock:ticker}] | High/Medium/Low |
| [Company 2] | [XXX] | [Sector] | [Advantage over {stock:ticker}] | High/Medium/Low |
| [Company 3] | [XXX] | [Sector] | [Advantage over {stock:ticker}] | High/Medium/Low |

---

## SMSF COMPLIANCE NOTE

### Concentration Risk Assessment
- **Current Concentration**: [High/Medium/Low] in {stock:industry} sector
- **Single Stock Risk**: [Significant/Moderate/Acceptable] exposure
- **ATO Requirement**: Per ATO guidelines, SMSFs must document investment strategy decisions

### Investment Strategy Justification
For SMSF trustees to document (per ATO requirements):
1. **Risk/Return Profile**: {stock:ticker} is classified as [High Risk/High Return growth stock]
2. **Diversification Consideration**: [How this affects portfolio diversification]
3. **Liquidity Assessment**: {stock:ticker} has [adequate/limited] trading liquidity
4. **Member Benefit Test**: Investment made solely for retirement benefits

### Compliance Action Required
[None / Review Investment Strategy document / Recommend trustee discussion]

---

## FOLLOW-UP PROTOCOL SUPPORT

This analysis supports follow-up queries:
- "Analyze a 20% shift into [Sector X]"
- "Stress test against a 10% market correction"
- "Find mid-cap alternatives with higher R&D ratios"

---

**DISCLAIMER**: This is general information only, not personal financial advice.
SMSF trustees should consult licensed advisers. Only ASX-listed stocks considered.

**Analysis Date**: [Use the current date provided in the system context above]
**Industry Sector**: {stock:industry}
"""
output_tags = ["smsf-recommendation", "{stock:ticker_lower}", "{stock:industry}", "smsf-report", "smsf-portfolio"]

# =========================================================================
# NOTE: Email handled at job definition level
# =========================================================================
# This template does NOT include email. Email is configured in:
# - asx-stocks-daily.toml: Sends individual stock emails after each analysis
# - smsf-portfolio-daily.toml: Sends ONE consolidated portfolio email at end
