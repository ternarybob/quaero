# Navexa Portfolio Analysis - Orchestrator Goal Template
# =========================================================================
# Reusable goal and tools for Navexa portfolio analysis.
# Referenced by job definitions via goal_template = "navexa-portfolio-analysis-goal"
#
# This template defines:
# - Portfolio discovery (fetch portfolios, holdings, performance from Navexa API)
# - Stock analysis for ASX-listed holdings
# - P/L calculations using Navexa performance data
# - Recommendations based on fundamentals and technicals
#
# NOTE: Unlike SMSF template which requires manual variable entry,
# this template DISCOVERS portfolios dynamically via Navexa API.
# =========================================================================

id = "navexa-portfolio-analysis-goal"
name = "Navexa Portfolio Analysis Goal Template"
type = "orchestrator_template"
description = "Reusable goal and tools for AI-powered Navexa portfolio analysis"

[template]
# Thinking level for LLM reasoning depth
thinking_level = "HIGH"

# Model preference (auto selects based on task complexity)
model_preference = "auto"

# Output tags - allows email step to find this document via body_from_tag
output_tags = ["navexa-portfolio-review"]

# Natural language goal - discover and analyze Navexa portfolios
goal = """
Perform a comprehensive portfolio analysis using data from Navexa.

IMPORTANT: This analysis uses LIVE portfolio data from Navexa API.
No manual variable entry required - portfolios are discovered automatically.

=== PHASE 1: PORTFOLIO DISCOVERY ===

1. FETCH PORTFOLIOS: Use fetch_portfolios to get all user portfolios from Navexa
   - Returns portfolio IDs and names
   - Proceed with each portfolio found

2. FETCH HOLDINGS: For EACH portfolio:
   - Use fetch_holdings with portfolio_id and portfolio_name
   - Captures: symbols, exchanges, sectors, industries

3. FETCH PERFORMANCE: For EACH portfolio:
   - Use fetch_performance with portfolio_id and portfolio_name
   - Captures: P/L, returns, capital gains, dividends
   - Use default 1-year period or specify from/to dates

=== PHASE 2: STOCK ANALYSIS ===

For EACH ASX-listed holding (Exchange = 'ASX'):

4. COMPREHENSIVE STOCK DATA:
   - Use fetch_stock_data with period: Y2 for 2-year historical data
   - Provides: prices, technicals, analyst coverage, financials

5. ANNOUNCEMENTS:
   - Use fetch_announcements with period: M6 for 6 months
   - Captures: FY/HY results, trading updates

6. NEWS (optional):
   - Use search_web for market sentiment
   - Use sparingly - fundamentals are in stock data

=== PHASE 3: SYNTHESIS ===

7. PORTFOLIO VALUATION:
   - Use Navexa performance data for accurate P/L
   - Cross-reference with current stock prices
   - Calculate total portfolio value and return

8. ANALYSIS SUMMARY:
   - Use analyze_summary to generate comprehensive review
   - Include: valuation, P/L breakdown, recommendations
   - Tag output with ['navexa-portfolio-review']

If data is missing for any stock:
- Calculate what you can with available data
- Note missing data explicitly
- Continue with remaining analysis

FINAL OUTPUT MUST INCLUDE:

1. PORTFOLIO OVERVIEW:
   - Portfolio name and currency
   - Total value, cost basis, P/L

2. HOLDINGS TABLE:
   Ticker | Name | Exchange | Sector | P/L | Return%

3. PERFORMANCE BREAKDOWN:
   - Capital gains, dividends, currency gains
   - Comparison to benchmarks

4. RECOMMENDATIONS (for ASX holdings):
   Ticker | Quality | Action | Conviction

5. RISK ALERTS:
   - Concentration warnings
   - Holdings at technical extremes
   - Quality concerns
"""

# Available tools - workers exposed to the orchestrator as callable tools
available_tools = [
    { name = "fetch_portfolios", description = "Fetch all Navexa portfolios for the authenticated user. Creates document tagged with ['navexa-portfolio']. No params required. Returns: portfolio IDs, names, currencies.", worker = "navexa_portfolios" },
    { name = "fetch_holdings", description = "Fetch holdings for a specific Navexa portfolio. Creates document tagged with ['navexa-holdings', '<portfolio_name>']. REQUIRED params: portfolio_id (int), portfolio_name (string). Returns: symbols, exchanges, sectors, industries.", worker = "navexa_holdings" },
    { name = "fetch_performance", description = "Fetch P/L performance for a Navexa portfolio. Creates document tagged with ['navexa-performance', '<portfolio_name>']. REQUIRED params: portfolio_id (int), portfolio_name (string). OPTIONAL: from (date), to (date), group_by (string). Returns: P/L, returns, capital gains, dividends.", worker = "navexa_performance" },
    { name = "fetch_stock_data", description = "Fetch comprehensive ASX stock data including prices, technicals, analyst coverage, and historical financials. Creates document tagged with ['asx-stock-data', '<ticker>']. REQUIRED params: asx_code (string). OPTIONAL: period (string) - M1, M3, M6, Y1, Y2, Y5 (default Y2).", worker = "asx_stock_collector" },
    { name = "fetch_announcements", description = "Fetch official ASX company announcements with price sensitivity flags. Creates document tagged with ['asx-announcement', '<ticker>']. REQUIRED params: asx_code (string). OPTIONAL: period (string) - D1, W1, M1, M3, M6, Y1, Y5 (default Y1).", worker = "asx_announcements" },
    { name = "search_web", description = "Search web for financial news and company research. Creates document tagged with ['web-search']. REQUIRED params: query (string). Use for: news, competitor analysis.", worker = "web_search" },
    { name = "analyze_summary", description = "Generate deep LLM-based analysis from collected documents. REQUIRED params: prompt (string) - analysis instructions, filter_tags (array) - tags to filter documents. OPTIONAL: thinking_level (string) - LOW or HIGH. Use HIGH for portfolio analysis.", worker = "summary" },
]

# Output schema reference - loads external JSON schema from ../schemas/
output_schema_ref = "portfolio-review.schema.json"
