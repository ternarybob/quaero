{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "portfolio-review.schema.json",
  "title": "Portfolio Review Schema",
  "description": "Schema for SMSF portfolio analysis with P/L calculations and recommendations",
  "type": "object",
  "required": ["portfolio_valuation", "total_summary", "recommendations", "portfolio_mix", "risk_alerts"],
  "properties": {
    "portfolio_valuation": {
      "type": "array",
      "description": "Valuation table for each holding",
      "items": {
        "type": "object",
        "required": ["ticker", "units", "avg_cost", "current_price", "current_value", "unrealized_pl", "return_pct", "weight_pct"],
        "properties": {
          "ticker": {
            "type": "string",
            "description": "ASX stock ticker code"
          },
          "name": {
            "type": "string",
            "description": "Company full name"
          },
          "units": {
            "type": "number",
            "description": "Number of shares held"
          },
          "avg_cost": {
            "type": "number",
            "description": "Average purchase price per share"
          },
          "current_price": {
            "type": "number",
            "description": "Current market price per share"
          },
          "current_value": {
            "type": "number",
            "description": "Current market value (units x current_price)"
          },
          "cost_basis": {
            "type": "number",
            "description": "Total cost basis (units x avg_cost)"
          },
          "unrealized_pl": {
            "type": "number",
            "description": "Unrealized profit/loss (current_value - cost_basis)"
          },
          "return_pct": {
            "type": "number",
            "description": "Return percentage as decimal (e.g., 0.15 for 15%)"
          },
          "weight_pct": {
            "type": "number",
            "description": "Portfolio weight percentage as decimal"
          }
        }
      }
    },
    "total_summary": {
      "type": "object",
      "description": "Total portfolio summary",
      "required": ["total_investment", "total_value", "total_pl", "overall_return_pct"],
      "properties": {
        "total_investment": {
          "type": "number",
          "description": "Sum of all cost bases"
        },
        "total_value": {
          "type": "number",
          "description": "Sum of all current values"
        },
        "total_pl": {
          "type": "number",
          "description": "Total unrealized P/L"
        },
        "overall_return_pct": {
          "type": "number",
          "description": "Overall return percentage as decimal"
        }
      }
    },
    "recommendations": {
      "type": "array",
      "description": "Recommendations for each holding",
      "items": {
        "type": "object",
        "required": ["ticker", "quality_rating", "trader_recommendation", "super_recommendation"],
        "properties": {
          "ticker": {
            "type": "string",
            "description": "ASX stock ticker code"
          },
          "quality_rating": {
            "type": "string",
            "enum": ["A", "B", "C", "D", "F"],
            "description": "Company quality grade"
          },
          "quality_reasoning": {
            "type": "string",
            "description": "Brief explanation of quality rating"
          },
          "trader_recommendation": {
            "type": "object",
            "required": ["action", "conviction"],
            "properties": {
              "action": {
                "type": "string",
                "enum": ["STRONG BUY", "BUY", "HOLD", "SELL", "STRONG SELL"]
              },
              "conviction": {
                "type": "integer",
                "minimum": 1,
                "maximum": 10
              }
            }
          },
          "super_recommendation": {
            "type": "object",
            "required": ["action", "conviction"],
            "properties": {
              "action": {
                "type": "string",
                "enum": ["ACCUMULATE", "HOLD", "REDUCE", "AVOID"]
              },
              "conviction": {
                "type": "integer",
                "minimum": 1,
                "maximum": 10
              }
            }
          }
        }
      }
    },
    "portfolio_mix": {
      "type": "object",
      "description": "Portfolio mix analysis",
      "properties": {
        "industry_breakdown": {
          "type": "array",
          "description": "Industry concentration breakdown",
          "items": {
            "type": "object",
            "properties": {
              "industry": {
                "type": "string"
              },
              "weight_pct": {
                "type": "number"
              }
            }
          }
        },
        "risk_profile": {
          "type": "string",
          "enum": ["Conservative", "Balanced", "Aggressive"],
          "description": "Overall risk profile"
        },
        "diversification_score": {
          "type": "string",
          "enum": ["Poor", "Moderate", "Good", "Excellent"],
          "description": "Diversification assessment"
        },
        "defensive_pct": {
          "type": "number",
          "description": "Percentage in defensive assets"
        },
        "growth_pct": {
          "type": "number",
          "description": "Percentage in growth assets"
        },
        "income_yield": {
          "type": "number",
          "description": "Portfolio dividend yield as decimal"
        }
      }
    },
    "priority_actions": {
      "type": "object",
      "description": "Priority actions for the portfolio",
      "properties": {
        "trader_opportunities": {
          "type": "array",
          "description": "Short-term trading opportunities",
          "items": {
            "type": "string"
          }
        },
        "super_accumulate": {
          "type": "array",
          "description": "Long-term accumulation targets",
          "items": {
            "type": "string"
          }
        },
        "rebalancing": {
          "type": "array",
          "description": "Rebalancing recommendations",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "risk_alerts": {
      "type": "array",
      "description": "Risk alerts and warnings",
      "items": {
        "type": "string"
      }
    }
  }
}
