# Moneyball Portfolio Assessment Job Definition
# =========================================================================
# Executes the Moneyball stock assessment template for a portfolio of stocks,
# then aggregates results into a portfolio-level analysis report.
#
# This job demonstrates portfolio-level analysis using the job_template worker
# to process multiple stocks, followed by an aggregation summary.
#
# USAGE:
# Modify the 'variables' array below to specify your portfolio stocks.
# Each stock should include: ticker, name, and industry.
# =========================================================================

id = "moneyball-portfolio-analysis"
name = "Moneyball Portfolio Assessment"
type = "portfolio_analysis"
description = "Quantitative Moneyball strategy assessment for SMSF stock portfolio"
tags = ["moneyball", "portfolio", "smsf", "quantitative-investing"]
schedule = ""
timeout = "60m"
enabled = true
auto_start = false

# =========================================================================
# Step 1: Execute Moneyball Template for Each Stock
# =========================================================================
# Uses the job_template worker to run the moneyball-stock-assessment template
# for each stock in the portfolio. Each stock is analyzed independently.

[step.analyze_portfolio_stocks]
type = "job_template"
description = "Run Moneyball analysis for each portfolio stock"
on_error = "continue"
template = "moneyball-stock-assessment"
parallel = false

# Portfolio stocks - modify this array for your SMSF portfolio
# Each item spawns a separate analysis job
[[step.analyze_portfolio_stocks.variables]]
ticker = "GNP"
name = "GenusPlus Group"
industry = "engineering"

[[step.analyze_portfolio_stocks.variables]]
ticker = "CBA"
name = "Commonwealth Bank"
industry = "banking"

[[step.analyze_portfolio_stocks.variables]]
ticker = "CSL"
name = "CSL Limited"
industry = "healthcare"

[[step.analyze_portfolio_stocks.variables]]
ticker = "BHP"
name = "BHP Group"
industry = "mining"

[[step.analyze_portfolio_stocks.variables]]
ticker = "WES"
name = "Wesfarmers"
industry = "retail"

# =========================================================================
# Step 2: Generate Portfolio-Level Summary
# =========================================================================
# Aggregates all individual stock analyses into a portfolio-level report
# with industry groupings and overall portfolio recommendations.

[step.portfolio_summary]
type = "summary"
description = "Generate portfolio-level Moneyball summary report"
depends = "analyze_portfolio_stocks"
on_error = "fail"
filter_tags = ["moneyball-recommendation"]
api_key = "{google_gemini_api_key}"
prompt = """You are the Chief Investment Officer for an SMSF applying the Moneyball quantitative strategy.

Aggregate all individual stock analyses into a comprehensive portfolio report.

# SMSF MONEYBALL PORTFOLIO REPORT
## Quantitative Investment Analysis

---

## PORTFOLIO OVERVIEW

| Stock | Industry | Moneyball Score | Recommendation | Conviction |
|-------|----------|-----------------|----------------|------------|
[List each stock from the analyses]

---

## INDUSTRY ALLOCATION

### Current Portfolio Composition
| Industry | Stocks | Weight | Recommendation |
|----------|--------|--------|----------------|
| Banking | | % | |
| Healthcare | | % | |
| Mining | | % | |
| Retail | | % | |
| Engineering | | % | |

### Industry Outlook Summary
[Brief outlook for each industry represented]

---

## MONEYBALL STRATEGY COMPLIANCE

### Portfolio-Level Metrics
- **Average Moneyball Score**: X/25
- **Diversification**: Adequate/Needs Attention
- **Quality Tilt**: Yes/No
- **Value Tilt**: Yes/No

### Stocks Meeting Moneyball Criteria
**BUY Recommendations** (High Moneyball Fit):
- [List stocks with BUY rating]

**HOLD Recommendations** (Moderate Fit):
- [List stocks with HOLD rating]

**SELL Recommendations** (Poor Fit):
- [List stocks with SELL rating]

---

## PORTFOLIO ACTION PLAN

### Immediate Actions
1. [Priority action 1]
2. [Priority action 2]
3. [Priority action 3]

### Rebalancing Recommendations
- Increase exposure to: [Underweight sectors/stocks]
- Reduce exposure to: [Overweight or SELL candidates]
- Maintain exposure to: [HOLD candidates]

### Risk Management
- Portfolio concentration risk: [Assessment]
- Sector correlation risk: [Assessment]
- Recommended hedging: [If applicable]

---

## SMSF COMPLIANCE CHECK

- [ ] Sole purpose test: Portfolio aligned with retirement objectives
- [ ] Diversification: Adequate spread across sectors
- [ ] Liquidity: Sufficient for pension obligations
- [ ] Documentation: All investment decisions recorded

---

## CONCLUSION

[2-3 paragraph executive summary of portfolio health and recommended actions]

---
**Report Generated**: [Current Date]
**Analysis Engine**: Quaero Moneyball Strategy
**Report Type**: SMSF Portfolio Review
"""
output_tags = ["moneyball-portfolio-report", "smsf-report"]

# =========================================================================
# Step 3: Email Portfolio Report
# =========================================================================
# Sends the complete portfolio analysis report.

[step.email_portfolio_report]
type = "email"
description = "Email complete SMSF Moneyball portfolio report"
depends = "portfolio_summary"
on_error = "fail"
to = "bobmcallan@gmail.com"
subject = "SMSF Moneyball Portfolio Analysis - Complete Assessment Report"
body_from_tag = "moneyball-portfolio-report"
