# Quaero Configuration
# ====================
#
# This file contains ONLY user-facing configuration settings.
# Technical parameters (cache sizes, timeouts, dimensions, etc.) have sensible
# defaults hardcoded in the application and should not be modified unless you
# are debugging or have specific requirements.
#
# Configuration Load Order (priority from lowest to highest):
#   1. Defaults (hardcoded in application)
#   2. TOML file (this file)
#   3. Environment variables (QUAERO_*)
#   4. Command line flags (--port, --host, --config)
#
# Only uncomment settings you want to override from defaults.

# =============================================================================
# Environment Configuration
# =============================================================================
# Controls environment mode: "development" or "production"
# Production mode rejects test URLs (localhost, 127.0.0.1, etc.) for safety
# Default: development (allows test URLs)
# Env vars: QUAERO_ENV, GO_ENV (highest priority)

environment = "development"  # "development" or "production"

# =============================================================================
# Server Configuration
# =============================================================================
# Defaults: port=8080, host="localhost", llama_dir="./llama"
# CLI flags: --port, --host (highest priority)
# Env vars: QUAERO_SERVER_PORT, QUAERO_SERVER_HOST, QUAERO_SERVER_LLAMA_DIR

[server]
# port = 8080         # Default: 8080
# host = "localhost"  # Default: localhost
# llama_dir = "./llama"  # Directory containing llama-server binary

# =============================================================================
# Storage Configuration
# =============================================================================
# Defaults: path="./data/quaero.db"
# Env vars: QUAERO_SQLITE_PATH

[storage.sqlite]
# path = "./data/quaero.db"  # Default: ./data/quaero.db

[storage.filesystem]
# images = "./data/images"           # Default: ./data/images
# attachments = "./data/attachments" # Default: ./data/attachments

# =============================================================================
# LLM Configuration
# =============================================================================
# âš ï¸  CRITICAL: Offline LLM requires llama-server binary + model files
# If llama-server binary is not found, service will automatically fall back
# to MOCK mode and emit detailed warnings about missing offline LLM setup.
#
# REQUIREMENTS for offline mode:
# 1. llama-server binary (see installation instructions below)
# 2. GGUF model files (embedding + chat models)
#
# ðŸ“– See README.md 'LLM Setup' section for complete installation guide
#
# Modes:
# - "offline" (default): Local models via llama-server (100% local, no network)
# - "cloud": External API providers (sends data externally - security implications)
# - "mock": Fake responses for testing (used when offline setup incomplete)
#
# Env var: QUAERO_LLM_MODE

[llm]
mode = "offline"  # "offline" or "cloud"

# Offline Mode - Local models via llama-server (100% local, no network calls)
#
# ðŸ”§ llama-server binary search paths (checked in order):
#   1. {server.llama_dir}/llama-server (default: ./llama/llama-server)
#   2. ./bin/llama-server
#   3. ./llama-server
#   4. System PATH (llama-server command)
#
# ðŸ’¡ Override search paths:
#   - Config: server.llama_dir = "/custom/path"
#   - Env: QUAERO_SERVER_LLAMA_DIR="/custom/path"
#
# ðŸ“¦ llama-server installation methods:
#   - Windows (winget): winget install llama.cpp
#   - macOS (Homebrew): brew install llama.cpp
#   - Linux (Nix): nix profile install nixpkgs#llama-cpp
#   - Manual: Download from https://github.com/ggml-org/llama.cpp/releases
#
# ðŸ¤– Model requirements:
#   - Embedding model: nomic-embed-text-v1.5-q8.gguf (~150MB)
#   - Chat model: qwen2.5-7b-instruct-q4.gguf (~4.5GB)
#
# ðŸ“ Directory structure expected:
#   ./llama/llama-server.exe    # Binary
#   ./models/nomic-embed-text-v1.5-q8.gguf
#   ./models/qwen2.5-7b-instruct-q4.gguf
#
# âš ï¸  Troubleshooting: Check server startup logs for:
#   - "LLM service initialized in offline mode" âœ…
#   - "Failed to create offline LLM service, falling back to MOCK mode" âŒ
#
# ðŸ”— Model downloads:
#   - Embedding: https://huggingface.co/nomic-ai/nomic-embed-text-v1.5-GGUF/resolve/main/nomic-embed-text-v1.5.Q8_0.gguf
#   - Chat: https://huggingface.co/Qwen/Qwen2.5-7B-Instruct-GGUF/resolve/main/qwen2.5-7b-instruct-q4_0.gguf

[llm.offline]
model_dir = "./models"                          # Directory containing GGUF model files
embed_model = "nomic-embed-text-v1.5-q8.gguf"  # Embedding model (~150MB)
# Download: https://huggingface.co/nomic-ai/nomic-embed-text-v1.5-GGUF/resolve/main/nomic-embed-text-v1.5.Q8_0.gguf
chat_model = "qwen2.5-7b-instruct-q4.gguf"     # Chat model (~4.5GB)
# Download: https://huggingface.co/Qwen/Qwen2.5-7B-Instruct-GGUF/resolve/main/qwen2.5-7b-instruct-q4_0.gguf

# Cloud Mode - API providers (sends data to external APIs)
# WARNING: Only use cloud mode if you understand the security implications
# [llm.cloud]
# provider = "gemini"                  # "gemini", "openai", "anthropic"
# api_key = "${QUAERO_LLM_CLOUD_API_KEY}"  # Use environment variable
# embed_model = "text-embedding-004"   # Cloud embedding model
# chat_model = "gemini-1.5-flash"      # Cloud chat model

# Audit Logging - Compliance and security
[llm.audit]
enabled = true      # Enable audit logging to SQLite
log_queries = false # Don't log query text (PII protection)

# =============================================================================
# Default Jobs Configuration
# =============================================================================
# Default jobs are system-managed scheduled tasks that run automatically.
# These jobs cannot be removed, only enabled/disabled.
# Minimum interval is 5 minutes.
# Schedule uses cron format: minute hour day month weekday
# Jobs run independently but not concurrently (mutex-protected).
#
# The `auto_start` option controls whether jobs execute immediately when the service starts.
# Set `auto_start = true` to run jobs on startup (useful for initial data collection).
# Set `auto_start = false` (default) to only run jobs on schedule or manual trigger.
# Auto-start is independent of the cron schedule.
#
# Examples:
# To collect data immediately on startup, set `auto_start = true` for crawl_and_collect.
# Jobs with `auto_start = false` will wait for their first scheduled run.
# Manual job triggering via API/UI works regardless of auto_start setting.

[jobs.crawl_and_collect]
enabled = true
auto_start = false  # Execute immediately on service startup (default: false)
schedule = "*/5 * * * *"  # Every 5 minutes
description = "Crawl and collect website data, store as markdown"

[jobs.scan_and_summarize]
enabled = true
auto_start = false  # Execute immediately on service startup (default: false)
schedule = "*/10 * * * *"  # Every 10 minutes
description = "Scan markdown documents and generate summaries with metadata"

# =============================================================================
# Crawler Configuration (Firecrawl-style HTML Scraping)
# =============================================================================
# Configure HTML scraping behavior for web page crawling.
# Follows Firecrawl architecture: scrape pages, convert to markdown, extract metadata.
# Technical parameters have sensible defaults hardcoded in the application.
# Only uncomment settings you want to override from defaults.
#
# Defaults: user_agent="Quaero/1.0 (Web Crawler)", max_concurrency=3,
#           request_delay=1s, random_delay=500ms, output_format="markdown"
# Env vars: QUAERO_CRAWLER_USER_AGENT, QUAERO_CRAWLER_MAX_CONCURRENCY, etc.

# [crawler]
# user_agent = "Quaero/1.0 (Web Crawler)"  # Default: Quaero/1.0 (Web Crawler)
# user_agent_rotation = true                # Default: true
# max_concurrency = 3                       # Default: 3
# request_delay = "1s"                      # Default: 1s
# random_delay = "500ms"                    # Default: 500ms
# request_timeout = "30s"                   # Default: 30s
# max_body_size = 10485760                  # Default: 10MB
# max_depth = 5                             # Default: 5
# follow_robots_txt = true                  # Default: true
# output_format = "markdown"                # Default: markdown (options: markdown, html, both)
# only_main_content = true                  # Default: true
# include_links = true                      # Default: true
# include_metadata = true                   # Default: true

# =============================================================================
# Logging Configuration
# =============================================================================
# Configure application logging and real-time UI event publishing.
#
# Log Flow Architecture:
#   Services â†’ Arbor Logger â†’ LogService â†’ [Database + EventService]
#                                             â†“           â†“
#                                        (all logs)   (filtered)
#                                                        â†“
#                                                   WebSocket â†’ UI
#
# Key Concept: LogService filters logs and publishes to EventService.
# Only logs >= min_event_level are published as events to the UI.
# All logs (regardless of level) are saved to the database for auditing.
#
# Defaults: level="info", format="text", min_event_level="info"
# Env vars: QUAERO_LOG_LEVEL, QUAERO_LOG_FORMAT, QUAERO_LOG_MIN_EVENT_LEVEL

# [logging]
# level = "info"            # Application log level: debug, info, warn, error (default: info)
# format = "text"           # Log format: text or json (default: text)
# output = ["stdout", "file"]  # Log destinations (default: ["stdout", "file"])
# min_event_level = "info"  # Minimum log level to publish as real-time events to UI
#                           # Logs below this level go to database only, not to UI
#                           # Options: "debug", "info", "warn", "error"
#                           # Example: Set to "warn" to only show warnings/errors in UI
#                           # Example: Set to "debug" to show all logs in UI (verbose)

# =============================================================================
# WebSocket Event Broadcasting Configuration
# =============================================================================
# Configure server-side filtering for real-time event broadcasting to browser UI.
# Events are filtered before broadcasting to reduce client load and network traffic.
#
# Defaults: allowed_events=[] (all), throttle_intervals={crawl_progress:1s, job_spawn:500ms}
# Env vars: QUAERO_WEBSOCKET_ALLOWED_EVENTS, QUAERO_WEBSOCKET_THROTTLE_CRAWL_PROGRESS, QUAERO_WEBSOCKET_THROTTLE_JOB_SPAWN

# [websocket]
# Event Filtering - Control which events are broadcast to WebSocket clients
# allowed_events = []  # Empty list allows all events (default)
# allowed_events = [   # Whitelist specific events (example)
#     "job_created",
#     "job_started",
#     "job_completed",
#     "job_failed",
#     "job_cancelled",
#     "crawl_progress",
#     "job_spawn",
#     "log_event",     # Real-time log streaming (filtered by logging.min_event_level)
# ]

# Event Throttling - Rate limit high-frequency events to prevent WebSocket flooding
# [websocket.throttle_intervals]
# crawl_progress = "1s"   # Max 1 crawl progress update per second per job (default)
# job_spawn = "500ms"     # Max 2 job spawn events per second (default)
