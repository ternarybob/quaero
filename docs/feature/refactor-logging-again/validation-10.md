# Validation 10: Log Total Count Mismatch Fix

## Build Status
âœ… BUILD PASSES

## Issue Addressed
The SSE handler was incorrectly using the JOB's total log count for individual STEP's totalLogCount.

**Before:**
```javascript
// BUG: data.meta.total_count is the JOB's total, not step's total
totalLogCount: data.meta?.total_count || mergedLogs.length
```

**After:**
```javascript
// FIXED: Use step's actual log count
totalLogCount: mergedLogs.length
```

## Changes Made
- `pages/queue.html:4898-4900` - Changed to use step's merged logs count instead of job's total count

## Remaining Issue: Line Number Display
The user reports that line numbers 1-100 are still being generated by the UI instead of showing server-provided values.

### Analysis:
The display logic at line 728 is:
```javascript
x-text="log.line_number || (logIdx + 1)"
```

This means:
- If `log.line_number > 0`, it shows the server value
- If `log.line_number === 0` or undefined, it falls back to `logIdx + 1`

### Possible Causes:
1. **Pre-existing logs** (before line_number feature) have `line_number: 0`
2. **API response** might not include `line_number` in some code paths
3. **SSE logs** might not have `line_number` properly set

### Server-side verification:
- `unified_logs_handler.go:564` - API includes `LineNumber: logEntries[i].LineNumber`
- `sse_logs_handler.go:910` - SSE includes `"line_number": log.LineNumber`
- `job_manager.go:892` - Event payload includes `"line_number": lineNumber`
- `log_storage.go:142` - Storage sets `entry.LineNumber = s.getNextLineNumber(ctx, counterKey)`

The server-side code appears correct. The issue may be:
1. Data from before the line_number implementation
2. A UI caching issue requiring hard refresh
3. The `step_id` context not being set correctly for the counter key

## Recommendation
User should:
1. Hard refresh browser (Ctrl+Shift+R)
2. Restart server to reset in-memory line counters
3. Run a fresh job and verify line numbers in Network tab (check `/api/logs` response)

## Result
**PARTIAL PASS** - totalLogCount fix applied. Line number display issue requires further investigation with fresh data.
