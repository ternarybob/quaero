{
  "task": "Update homepage UI test with service logs verification and debug logging validation",
  "folder": "update-homepage-test-logging",
  "complexity": "medium",
  "estimated_steps": 6,
  "steps": [
    {
      "id": 1,
      "task": "Add service logs check to TestHomepageElements",
      "rationale": "Need to verify service logs component exists on homepage and is displaying logs correctly",
      "dependencies": [],
      "validation_criteria": [
        "tests_must_pass",
        "code_compiles",
        "follows_conventions"
      ],
      "artifacts": [
        "test/ui/homepage_test.go"
      ],
      "risk_level": "low",
      "details": {
        "what_to_add": "Add check for .card element containing service logs (partials/service-logs.html template)",
        "what_to_verify": "Verify logs container exists and has logs array populated via Alpine.js serviceLogs component"
      }
    },
    {
      "id": 2,
      "task": "Investigate debug log filtering in logging architecture",
      "rationale": "Config shows min_event_level='debug' but debug logs may not appear if LogService filters them before publishing to EventService/WebSocket",
      "dependencies": [
        1
      ],
      "validation_criteria": [
        "no_root_binaries"
      ],
      "artifacts": [
        "docs/update-homepage-test-logging/architecture-analysis.md"
      ],
      "risk_level": "low",
      "details": {
        "investigation_areas": [
          "LogService filtering: Check if LogService filters by min_event_level before publishing log_event to EventService",
          "WebSocket subscription: Verify WebSocketHandler subscribes to 'log_event' from EventService (line 762 in websocket.go)",
          "Configuration flow: Trace how test-config.toml min_event_level='debug' is applied",
          "Event publishing: Determine where LogService publishes events and if debug logs are included"
        ],
        "expected_findings": "LogService likely filters logs based on min_event_level before publishing to EventService, so only filtered logs reach UI via WebSocket"
      }
    },
    {
      "id": 3,
      "task": "Create test for debug log visibility in UI",
      "rationale": "Validate that debug-level logs appear in service logs when min_event_level is set to 'debug'",
      "dependencies": [
        1,
        2
      ],
      "validation_criteria": [
        "tests_must_pass",
        "code_compiles",
        "follows_conventions"
      ],
      "artifacts": [
        "test/ui/homepage_test.go"
      ],
      "risk_level": "medium",
      "details": {
        "test_approach": [
          "Wait for service logs to populate (WebSocket connection already verified)",
          "Use chromedp to evaluate JavaScript and extract logs from Alpine.js serviceLogs.logs array",
          "Filter for DEBUG level logs",
          "Assert that at least one debug log exists if min_event_level='debug' in config"
        ],
        "potential_issues": "If LogService filters before EventService publish, debug logs won't reach UI even with min_event_level='debug'"
      }
    },
    {
      "id": 4,
      "task": "Verify log timestamp accuracy (service time vs UI time)",
      "rationale": "Ensure UI displays actual service log timestamps, not client-calculated/interpreted time",
      "dependencies": [
        3
      ],
      "validation_criteria": [
        "tests_must_pass",
        "code_compiles",
        "follows_conventions"
      ],
      "artifacts": [
        "test/ui/homepage_test.go"
      ],
      "risk_level": "low",
      "details": {
        "verification_approach": [
          "Extract timestamp from service logs in UI (Alpine.js serviceLogs component)",
          "Compare with service.log file timestamps",
          "Verify _formatLogTime function in common.js preserves HH:MM:SS format from server (lines 128-146)",
          "Confirm timestamps are not calculated client-side but passed through from server"
        ],
        "timestamp_flow": "Server (arbor logger) -> LogService -> EventService (log_event) -> WebSocket -> Alpine.js serviceLogs -> UI display"
      }
    },
    {
      "id": 5,
      "task": "Implement fixes based on test failures",
      "rationale": "Address any issues discovered during testing (debug log filtering, timestamp accuracy, etc.)",
      "dependencies": [
        3,
        4
      ],
      "validation_criteria": [
        "tests_must_pass",
        "code_compiles",
        "follows_conventions",
        "use_build_script"
      ],
      "artifacts": [
        "Variable - depends on issues found",
        "docs/update-homepage-test-logging/fixes-applied.md"
      ],
      "risk_level": "medium",
      "details": {
        "potential_fixes": [
          "If debug logs not appearing: Adjust LogService filtering logic to respect min_event_level config",
          "If timestamps wrong: Fix timestamp formatting in WebSocket handler or Alpine.js component",
          "If logs misaligned: Verify EventService log_event payload structure matches WebSocket subscriber expectations"
        ],
        "testing_approach": "Iterate test runs with ./scripts/build.ps1 and go test after each fix"
      }
    },
    {
      "id": 6,
      "task": "Run full test suite and validate all requirements",
      "rationale": "Final validation that all requirements are met and tests pass consistently",
      "dependencies": [
        5
      ],
      "validation_criteria": [
        "tests_must_pass",
        "code_compiles",
        "follows_conventions",
        "use_build_script",
        "no_root_binaries"
      ],
      "artifacts": [
        "test/results/ui/homepage-{timestamp}/",
        "docs/update-homepage-test-logging/summary.md"
      ],
      "risk_level": "low",
      "details": {
        "test_commands": [
          "cd test/ui",
          "go test -v -run TestHomepage"
        ],
        "success_criteria": [
          "All homepage tests pass",
          "Service logs component visible and populated",
          "Debug logs appear in UI when min_event_level='debug'",
          "Log timestamps match service log times (not calculated client-side)",
          "Screenshots captured showing service logs"
        ]
      }
    }
  ],
  "constraints": [
    "Must use ./scripts/build.ps1 for building (never manual go build with output)",
    "Tests must run from test/ui/ directory using Go's native test infrastructure",
    "Cannot modify core logging architecture without full impact analysis",
    "Must maintain backward compatibility with existing WebSocket log streaming",
    "Test results must be saved to test/results/ui/ with timestamps"
  ],
  "success_criteria": [
    "TestHomepageElements includes service logs component check",
    "New test verifies debug logs appear when min_event_level='debug'",
    "Test validates log timestamps match service log times (not client-calculated)",
    "All tests pass consistently",
    "Test results include screenshots showing service logs",
    "Documentation explains logging architecture and any fixes applied"
  ],
  "architecture_notes": {
    "logging_flow": [
      "Service code uses arbor logger with correlation IDs",
      "LogService consumes logs and filters by min_event_level (from config.toml)",
      "LogService publishes filtered logs as 'log_event' to EventService",
      "WebSocketHandler subscribes to 'log_event' (websocket.go:762)",
      "WebSocket broadcasts log messages to all connected clients",
      "Client Alpine.js serviceLogs component displays logs in UI"
    ],
    "key_files": {
      "config": "test/config/test-config.toml - min_event_level='debug'",
      "ui_component": "pages/partials/service-logs.html - Service logs card",
      "alpine_component": "pages/static/common.js:26-177 - serviceLogs Alpine.js component",
      "websocket": "internal/handlers/websocket.go:762-805 - log_event subscription",
      "event_service": "internal/services/events/event_service.go - Event pub/sub",
      "test": "test/ui/homepage_test.go - Homepage UI tests"
    },
    "potential_issues": [
      "LogService may filter debug logs before publishing to EventService",
      "Need to verify min_event_level config is read and applied correctly",
      "Timestamp format from server must be preserved through WebSocket to UI",
      "Alpine.js _formatLogTime should not recalculate times (lines 128-146 in common.js)"
    ]
  }
}
