# Announcement Analysis Report Template (Multi-Stock)
# Type: prompt (for SummaryWorker)
#
# Consolidates announcement signal-noise analyses for multiple stocks.
# Output is ordered alphabetically by ticker.
# Produces repeatable, schema-compliant multi-stock report.

type = "prompt"
schema_ref = "announcement-analysis-report.schema.json"

prompt = """
Consolidate the ASX announcement data for ALL stocks and produce a multi-stock announcement signal-noise analysis report.

CRITICAL REQUIREMENTS:
1. Output MUST list stocks ALPHABETICALLY by ticker code (e.g., GNP before SKS before WEB)
2. Output MUST be absolutely repeatable - same input data produces identical structure
3. EXCLUDE all noise items from output - only include HIGH and MODERATE signal announcements
4. Include source references for all data used per stock
5. Follow the schema exactly - no additional fields, no missing required fields

=== REPORT STRUCTURE ===

The output MUST contain:
1. analysis_date: Today's date in YYYY-MM-DD format
2. report_summary: 2-3 paragraph cross-stock summary
3. stocks: Array of individual stock analyses, SORTED ALPHABETICALLY BY TICKER

=== CROSS-STOCK SUMMARY ===

Generate a report_summary that:
1. Compares announcement quality across all stocks
2. Highlights which companies have best/worst signal-to-noise ratios
3. Identifies common themes across multiple companies
4. Notes any concerning patterns (e.g., multiple companies with high noise)

=== FOR EACH STOCK (alphabetically) ===

For each stock in the collected data, generate a complete analysis following the single-stock announcement-analysis pattern:

1. **Signal-to-Noise Classification**:
   - HIGH SIGNAL: Financial results, earnings guidance, major contracts, M&A, capital raises, CEO/CFO changes
   - MODERATE SIGNAL: Operational updates with metrics, board changes, AGM results, trading updates
   - LOW SIGNAL: Routine notices, standard filings, generic presentations (exclude from output)
   - NOISE: Registry changes, duplicate announcements, cleansing notices (exclude from output)

2. **Executive Summary**:
   - Act as a forensic auditor. Prioritize Operational Reality over Management Narrative.
   - If Noise Ratio > 0.3 or Leak Score > 0.2, DO NOT use positive adjectives like "strong", "proactive", or "reliable".
   - Highlight ANY divergence between price-sensitive labels and actual market reaction (Bluffs).

3. **Critical Assessment Table**:
   - Insert a markdown table with columns: Focus Area | Management Narrative | Operational Reality | Critical Assessment
   - Rows: Operational Success, Market Integrity, Technical Milestones.

4. **Strategic Divergence**:
   - Identify instances where the market "sold the news" on price-sensitive items.
   - Analyze if the stock is driven by technical milestones or retail hype.

5. **Signal-Noise Assessment**:
   - overall_rating: EXCELLENT (<0.3 noise), GOOD (0.3-0.5), AVERAGE (0.5-0.7), POOR (>0.7)
   - Counts for high/moderate/low/noise
   - noise_ratio calculation

6. **Announcements Analysis**:
   - Create a SINGLE table 'Announcements' containing HIGH and MODERATE signal announcements.
   - Do NOT create separate tables for High/Moderate. Consolidate them.
   - Columns: Date | Type | Headline | Signal | Rationale & Price Impact
   - Include detailed analysis within the table rows (multiline okay if needed).
   - "Signal" column should be HIGH or MODERATE.
   - "Rationale & Price Impact" should explain the significance and cite price/volume movement.
   - Sort by date descending.

7. **Routine Announcements**:
   - Provide a separate "Routine Administrative Announcements" section.
   - List routine items (Appendix 3Y, etc.) as a bulleted list with brief summaries (Date - Headline).
   - Do NOT include these in the main Announcements table.
   - Deduplication: Provide a simple count summary (e.g., '15 announcements consolidated to 12'), do not list them.
   - Sort by date descending (most recent first)
   - Include rationale, price impact, AI analysis

7. **Anomalies**: Unexpected market reactions

8. **Pre-Announcement Movements**:
   - Flag all instances of Pre-Drift > 5% as "High Probability Information Leakage".
   - Highlight significant price drift before announcements.

7. **Dividend Announcements**: With context and notes

8. **Key Themes**: 3-7 themes per stock

9. **Sources**: Local documents, API sources, web sources

=== ALPHABETICAL ORDERING ===

CRITICAL: The stocks array MUST be sorted alphabetically by ticker.

Example correct ordering:
- BCN before GNP
- GNP before SKS
- SKS before WEB

=== OUTPUT FORMAT ===

Output MUST match announcement-analysis-report.schema.json exactly:

{
  "analysis_date": "YYYY-MM-DD",
  "report_summary": "Cross-stock comparative summary...",
  "stocks": [
    {
      "ticker": "AAA",  // First alphabetically
      "company_name": "...",
      "analysis_date": "YYYY-MM-DD",
      ...
    },
    {
      "ticker": "BBB",  // Second alphabetically
      ...
    },
    {
      "ticker": "ZZZ",  // Last alphabetically
      ...
    }
  ]
}

CRITICAL: Do NOT include noise or low-signal announcements in any high_signal_announcements array.
The output must be deterministic - same inputs produce same structure every time.
Stocks MUST be alphabetically ordered by ticker - this is a hard requirement.
"""
