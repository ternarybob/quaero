# Stock Analysis Prompt Template
# Type: prompt (for SummaryWorker)
#
# This is the SINGLE SOURCE OF TRUTH for stock analysis prompts.
# To customize, create deployments/common/templates/stock-analysis.toml

type = "prompt"
schema_ref = "stock-report.schema.json"

prompt = """
Analyze the collected stock data and provide comprehensive analysis for ALL stocks.

CRITICAL: You MUST analyze EVERY stock in the collected data. Sort stocks alphabetically by ticker.

For EACH stock in the collected data (in alphabetical order by ticker):

=== QUALITY ASSESSMENT ===

1. COMPANY QUALITY (A/B/C/D/F):
   - Revenue trajectory (growing/stable/declining)
   - Profit trajectory (NPAT/margin trends)
   - Quality reasoning (2-3 sentences explaining the grade)

   Grading criteria:
   - A: Excellent - Strong growth, healthy margins, clear competitive advantage
   - B: Good - Solid fundamentals, stable or growing revenue
   - C: Average - Mixed results, some concerns but viable
   - D: Weak - Declining metrics, significant concerns
   - F: Speculative - High risk, uncertain future

=== TECHNICAL ANALYSIS ===

2. PRICE ACTION:
   - Current price vs SMA20/50/200
   - RSI14 position (overbought >70 / neutral 30-70 / oversold <30)
   - Support and resistance levels
   - Recent price momentum (trend direction and strength)

=== ANNOUNCEMENT ANALYSIS ===

3. SIGNAL:NOISE RATIO:
   - HIGH: Material financial data, major contracts, M&A activity
   - MEDIUM: Operational updates, board changes, guidance
   - LOW: Generic PR, routine notices, administrative filings

   IMPORTANT: You MUST provide 1-2 sentences explaining WHY you assigned this rating.
   Cite specific recent announcements that support your rating.
   Example: "HIGH - Recent announcements include $50M contract win (Dec 15) and quarterly results with 25% revenue growth (Nov 30)."

=== DUAL RECOMMENDATIONS ===

4. TRADER VIEW (1-12 week horizon):
   Focus: Technical momentum, short-term catalysts, entry/exit timing

   - Action: STRONG BUY / BUY / HOLD / SELL / STRONG SELL
   - Conviction: 1-10 (how confident in this recommendation)
   - Key triggers: What would change this view

5. SUPER VIEW (6 month - 2 year horizon):
   Focus: Company quality, long-term value, retirement suitability

   - Action: ACCUMULATE / HOLD / REDUCE / AVOID
   - Conviction: 1-10
   - Rationale: Long-term thesis

   IMPORTANT: Only Quality A/B stocks should receive ACCUMULATE recommendation

=== RISK ALERTS ===

6. FLAG CONCERNS:
   - Quality D/F stocks (high risk)
   - Stocks at technical extremes (overbought/oversold)
   - High sector concentration
   - Recent negative announcements

=== OUTPUT FORMAT ===

CRITICAL: Provide analysis for ALL stocks in the data, sorted alphabetically by ticker.

Your response MUST include:
1. "stocks" array: Complete analysis for EACH stock in alphabetical order
2. "summary_table" array: Row for each stock with: ticker, name, quality, trader_rec, trader_conv, super_rec, super_conv, signal_noise, cagr
3. "watchlists" object: trader_momentum and super_accumulate arrays (ticker codes only)
4. "definitions" object: Brief definitions of quality_rating, signal_noise_ratio, and cagr
5. "alerts" array: Any significant alerts (optional)

Output MUST match the stock-report.schema.json structure with ALL stocks included.
"""
