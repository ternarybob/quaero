=== RUN   TestJobRerun
    helpers.go:55: POST http://localhost:8085/api/sources
    helpers.go:127: Response body: {"id":"test-source-rerun-1","name":"Test Source for Rerun","type":"confluence","base_url":"https://rerun-test.atlassian.net","enabled":true,"auth_id":"","crawl_config":{"max_depth":1,"follow_links":false,"concurrency":1,"rate_limit":1000,"max_pages":5},"filters":null,"created_at":"2025-10-23T12:07:18.3012458+11:00","updated_at":"2025-10-23T12:07:18.3012458+11:00"}
    helpers.go:55: POST http://localhost:8085/api/job-definitions
    helpers.go:127: Response body: {"id":"test-job-rerun-def-1","name":"Test Job Definition","type":"crawler","description":"Test job","sources":["test-source-rerun-1"],"steps":[{"name":"crawl-step","action":"crawl","config":{"concurrency":1,"follow_links":false,"max_depth":1,"max_pages":5,"polling_timeout_seconds":0,"wait_for_completion":false},"on_error":"fail"}],"schedule":"","timeout":"","enabled":true,"auto_start":false,"config":null,"created_at":"2025-10-23T12:07:18.3033165+11:00","updated_at":"2025-10-23T12:07:18.3033165+11:00"}
    helpers.go:55: POST http://localhost:8085/api/job-definitions/test-job-rerun-def-1/execute
    helpers.go:48: GET http://localhost:8085/api/jobs
    helpers.go:127: Response body: {"jobs":[{"id":"2562ca09-d66d-4942-9fbc-ef8ce0ea3c16","name":"","description":"","source_type":"confluence","entity_type":"spaces","config":{"max_depth":1,"max_pages":5,"concurrency":1,"rate_limit":1000000000,"retry_attempts":3,"retry_backoff":2000000000,"include_patterns":[],"exclude_patterns":[],"follow_links":false,"detail_level":"full"},"source_config_snapshot":"{\"auth_id\":\"[REDACTED]\",\"base_url\":\"https://rerun-test.atlassian.net\",\"crawl_config\":{\"concurrency\":1,\"follow_links\":false,\"max_depth\":1,\"max_pages\":5,\"rate_limit\":1000},\"created_at\":\"2025-10-23T12:07:18+11:00\",\"enabled\":true,\"filters\":null,\"id\":\"test-source-rerun-1\",\"name\":\"Test Source for Rerun\",\"type\":\"confluence\",\"updated_at\":\"2025-10-23T12:07:18+11:00\"}","auth_snapshot":"","refresh_source":true,"status":"running","progress":{"total_urls":1,"completed_urls":0,"failed_urls":0,"pending_urls":1,"percentage":0,"start_time":"2025-10-23T12:07:18.3117316+11:00","estimated_completion":"0001-01-01T00:00:00Z"},"created_at":"2025-10-23T12:07:18+11:00","started_at":"2025-10-23T12:07:18+11:00","completed_at":"0001-01-01T00:00:00Z","result_count":0,"failed_count":0,"documents_saved":0,"seed_urls":["https://rerun-test.atlassian.net"]},{"id":"3e99b46e-329f-4c2f-b9c2-6e9dae168857","name":"","description":"","source_type":"confluence","entity_type":"spaces","config":{"max_depth":1,"max_pages":5,"concurrency":1,"rate_limit":1000000000,"retry_attempts":3,"retry_backoff":2000000000,"include_patterns":[],"exclude_patterns":[],"follow_links":false,"detail_level":"full"},"source_config_snapshot":"{\"auth_id\":\"[REDACTED]\",\"base_url\":\"https://rerun-test.atlassian.net\",\"crawl_config\":{\"concurrency\":1,\"follow_links\":false,\"max_depth\":1,\"max_pages\":5,\"rate_limit\":1000},\"created_at\":\"2025-10-23T10:37:53+11:00\",\"enabled\":true,\"filters\":null,\"id\":\"test-source-rerun-1\",\"name\":\"Test Source for Rerun\",\"type\":\"confluence\",\"updated_at\":\"2025-10-23T10:37:53+11:00\"}","auth_snapshot":"","refresh_source":true,"status":"failed","progress":{"total_urls":1,"completed_urls":0,"failed_urls":0,"pending_urls":1,"percentage":0,"start_time":"2025-10-23T10:37:53.8485345+11:00","estimated_completion":"0001-01-01T00:00:00Z"},"created_at":"2025-10-23T10:37:53+11:00","started_at":"2025-10-23T10:37:53+11:00","completed_at":"2025-10-23T10:39:08+11:00","error":"Service restarted while job was running","result_count":0,"failed_count":0,"documents_saved":0,"seed_urls":["https://rerun-test.atlassian.net"]},{"id":"eca367b8-5e43-4f58-8f39-95dad3085dfd","name":"","description":"","source_type":"confluence","entity_type":"spaces","config":{"max_depth":1,"max_pages":5,"concurrency":1,"rate_limit":1000000000,"retry_attempts":3,"retry_backoff":2000000000,"include_patterns":[],"exclude_patterns":[],"follow_links":false,"detail_level":"full"},"source_config_snapshot":"{\"auth_id\":\"[REDACTED]\",\"base_url\":\"https://rerun-test.atlassian.net\",\"crawl_config\":{\"concurrency\":1,\"follow_links\":false,\"max_depth\":1,\"max_pages\":5,\"rate_limit\":1000},\"created_at\":\"2025-10-23T10:34:40+11:00\",\"enabled\":true,\"filters\":null,\"id\":\"test-source-rerun-1\",\"name\":\"Test Source for Rerun\",\"type\":\"confluence\",\"updated_at\":\"2025-10-23T10:34:40+11:00\"}","auth_snapshot":"","refresh_source":true,"status":"completed","progress":{"total_urls":1,"completed_urls":0,"failed_urls":1,"pending_urls":0,"current_url":"https://rerun-test.atlassian.net","percentage":100,"start_time":"2025-10-23T10:34:40.0492218+11:00","estimated_completion":"0001-01-01T00:00:00Z"},"created_at":"2025-10-23T10:34:40+11:00","started_at":"2025-10-23T10:34:40+11:00","completed_at":"2025-10-23T10:34:44+11:00","result_count":0,"failed_count":1,"documents_saved":0,"seed_urls":["https://rerun-test.atlassian.net"]},{"id":"863fce52-9767-4429-ad2a-51d5ca780d4d","name":"","description":"","source_type":"jira","entity_type":"projects","config":{"max_depth":3,"max_pages":0,"concurrency":2,"rate_limit":0,"retry_attempts":3,"retry_backoff":2000000000,"include_patterns":[".*projects.*",".*browse.*"],"exclude_patterns":[],"follow_links":true,"detail_level":"full"},"source_config_snapshot":"{\"auth_id\":\"[REDACTED]\",\"base_url\":\"https://bobmcallan.atlassian.net/jira\",\"crawl_config\":{\"concurrency\":2,\"follow_links\":true,\"max_depth\":3,\"max_pages\":0,\"rate_limit\":0},\"created_at\":\"2025-10-21T19:30:59+11:00\",\"enabled\":true,\"filters\":{\"exclude_patterns\":\"\",\"include_patterns\":\"projects,browse\"},\"id\":\"cf377d86-cde2-439b-b2d6-723c9a290310\",\"name\":\"JIRa\",\"type\":\"jira\",\"updated_at\":\"2025-10-22T09:26:43+11:00\"}","auth_snapshot":"[REDACTED]","refresh_source":true,"status":"failed","progress":{"total_urls":421,"completed_urls":85,"failed_urls":0,"pending_urls":336,"current_url":"https://bobmcallan.atlassian.net/browse/BI9LLQNGKQ-45","percentage":20.19002375296912,"start_time":"2025-10-23T07:24:46.6356076+11:00","estimated_completion":"2025-10-23T07:41:10.352303916+11:00"},"created_at":"2025-10-23T07:24:46+11:00","started_at":"2025-10-23T07:24:46+11:00","completed_at":"2025-10-23T07:28:08+11:00","error":"Job stale (no heartbeat for 10+ minutes)","result_count":0,"failed_count":0,"documents_saved":0,"seed_urls":["https://bobmcallan.atlassian.net/jira"]}],"limit":50,"offset":0,"total_count":4}
    job_rerun_test.go:113: Found job: 2562ca09-d66d-4942-9fbc-ef8ce0ea3c16
    job_rerun_test.go:131: Waiting for job to finish...
    helpers.go:48: GET http://localhost:8085/api/jobs/2562ca09-d66d-4942-9fbc-ef8ce0ea3c16
    helpers.go:127: Response body: {"id":"2562ca09-d66d-4942-9fbc-ef8ce0ea3c16","name":"","description":"","source_type":"confluence","entity_type":"spaces","config":{"max_depth":1,"max_pages":5,"concurrency":1,"rate_limit":1000000000,"retry_attempts":3,"retry_backoff":2000000000,"include_patterns":[],"exclude_patterns":[],"follow_links":false,"detail_level":"full"},"source_config_snapshot":"{\"auth_id\":\"[REDACTED]\",\"base_url\":\"https://rerun-test.atlassian.net\",\"crawl_config\":{\"concurrency\":1,\"follow_links\":false,\"max_depth\":1,\"max_pages\":5,\"rate_limit\":1000},\"created_at\":\"2025-10-23T12:07:18+11:00\",\"enabled\":true,\"filters\":null,\"id\":\"test-source-rerun-1\",\"name\":\"Test Source for Rerun\",\"type\":\"confluence\",\"updated_at\":\"2025-10-23T12:07:18+11:00\"}","auth_snapshot":"","refresh_source":true,"status":"running","progress":{"total_urls":1,"completed_urls":0,"failed_urls":0,"pending_urls":1,"current_url":"https://rerun-test.atlassian.net","percentage":0,"start_time":"2025-10-23T12:07:18.3117316+11:00","estimated_completion":"0001-01-01T00:00:00Z"},"created_at":"2025-10-23T12:07:18.3117316+11:00","started_at":"2025-10-23T12:07:18.3127575+11:00","completed_at":"0001-01-01T00:00:00Z","result_count":0,"failed_count":0,"documents_saved":0,"seed_urls":["https://rerun-test.atlassian.net"]}
    helpers.go:48: GET http://localhost:8085/api/jobs/2562ca09-d66d-4942-9fbc-ef8ce0ea3c16
    helpers.go:127: Response body: {"id":"2562ca09-d66d-4942-9fbc-ef8ce0ea3c16","name":"","description":"","source_type":"confluence","entity_type":"spaces","config":{"max_depth":1,"max_pages":5,"concurrency":1,"rate_limit":1000000000,"retry_attempts":3,"retry_backoff":2000000000,"include_patterns":[],"exclude_patterns":[],"follow_links":false,"detail_level":"full"},"source_config_snapshot":"{\"auth_id\":\"[REDACTED]\",\"base_url\":\"https://rerun-test.atlassian.net\",\"crawl_config\":{\"concurrency\":1,\"follow_links\":false,\"max_depth\":1,\"max_pages\":5,\"rate_limit\":1000},\"created_at\":\"2025-10-23T12:07:18+11:00\",\"enabled\":true,\"filters\":null,\"id\":\"test-source-rerun-1\",\"name\":\"Test Source for Rerun\",\"type\":\"confluence\",\"updated_at\":\"2025-10-23T12:07:18+11:00\"}","auth_snapshot":"","refresh_source":true,"status":"running","progress":{"total_urls":1,"completed_urls":0,"failed_urls":0,"pending_urls":1,"current_url":"https://rerun-test.atlassian.net","percentage":0,"start_time":"2025-10-23T12:07:18.3117316+11:00","estimated_completion":"0001-01-01T00:00:00Z"},"created_at":"2025-10-23T12:07:18.3117316+11:00","started_at":"2025-10-23T12:07:18.3127575+11:00","completed_at":"0001-01-01T00:00:00Z","result_count":0,"failed_count":0,"documents_saved":0,"seed_urls":["https://rerun-test.atlassian.net"]}
    helpers.go:48: GET http://localhost:8085/api/jobs/2562ca09-d66d-4942-9fbc-ef8ce0ea3c16
    helpers.go:127: Response body: {"id":"2562ca09-d66d-4942-9fbc-ef8ce0ea3c16","name":"","description":"","source_type":"confluence","entity_type":"spaces","config":{"max_depth":1,"max_pages":5,"concurrency":1,"rate_limit":1000000000,"retry_attempts":3,"retry_backoff":2000000000,"include_patterns":[],"exclude_patterns":[],"follow_links":false,"detail_level":"full"},"source_config_snapshot":"{\"auth_id\":\"[REDACTED]\",\"base_url\":\"https://rerun-test.atlassian.net\",\"crawl_config\":{\"concurrency\":1,\"follow_links\":false,\"max_depth\":1,\"max_pages\":5,\"rate_limit\":1000},\"created_at\":\"2025-10-23T12:07:18+11:00\",\"enabled\":true,\"filters\":null,\"id\":\"test-source-rerun-1\",\"name\":\"Test Source for Rerun\",\"type\":\"confluence\",\"updated_at\":\"2025-10-23T12:07:18+11:00\"}","auth_snapshot":"","refresh_source":true,"status":"running","progress":{"total_urls":1,"completed_urls":0,"failed_urls":0,"pending_urls":1,"current_url":"https://rerun-test.atlassian.net","percentage":0,"start_time":"2025-10-23T12:07:18.3117316+11:00","estimated_completion":"0001-01-01T00:00:00Z"},"created_at":"2025-10-23T12:07:18.3117316+11:00","started_at":"2025-10-23T12:07:18.3127575+11:00","completed_at":"0001-01-01T00:00:00Z","result_count":0,"failed_count":0,"documents_saved":0,"seed_urls":["https://rerun-test.atlassian.net"]}
    helpers.go:48: GET http://localhost:8085/api/jobs/2562ca09-d66d-4942-9fbc-ef8ce0ea3c16
    helpers.go:127: Response body: {"id":"2562ca09-d66d-4942-9fbc-ef8ce0ea3c16","name":"","description":"","source_type":"confluence","entity_type":"spaces","config":{"max_depth":1,"max_pages":5,"concurrency":1,"rate_limit":1000000000,"retry_attempts":3,"retry_backoff":2000000000,"include_patterns":[],"exclude_patterns":[],"follow_links":false,"detail_level":"full"},"source_config_snapshot":"{\"auth_id\":\"[REDACTED]\",\"base_url\":\"https://rerun-test.atlassian.net\",\"crawl_config\":{\"concurrency\":1,\"follow_links\":false,\"max_depth\":1,\"max_pages\":5,\"rate_limit\":1000},\"created_at\":\"2025-10-23T12:07:18+11:00\",\"enabled\":true,\"filters\":null,\"id\":\"test-source-rerun-1\",\"name\":\"Test Source for Rerun\",\"type\":\"confluence\",\"updated_at\":\"2025-10-23T12:07:18+11:00\"}","auth_snapshot":"","refresh_source":true,"status":"running","progress":{"total_urls":1,"completed_urls":0,"failed_urls":0,"pending_urls":1,"current_url":"https://rerun-test.atlassian.net","percentage":0,"start_time":"2025-10-23T12:07:18.3117316+11:00","estimated_completion":"0001-01-01T00:00:00Z"},"created_at":"2025-10-23T12:07:18.3117316+11:00","started_at":"2025-10-23T12:07:18.3127575+11:00","completed_at":"0001-01-01T00:00:00Z","result_count":0,"failed_count":0,"documents_saved":0,"seed_urls":["https://rerun-test.atlassian.net"]}
    helpers.go:48: GET http://localhost:8085/api/jobs/2562ca09-d66d-4942-9fbc-ef8ce0ea3c16
    helpers.go:127: Response body: {"id":"2562ca09-d66d-4942-9fbc-ef8ce0ea3c16","name":"","description":"","source_type":"confluence","entity_type":"spaces","config":{"max_depth":1,"max_pages":5,"concurrency":1,"rate_limit":1000000000,"retry_attempts":3,"retry_backoff":2000000000,"include_patterns":[],"exclude_patterns":[],"follow_links":false,"detail_level":"full"},"source_config_snapshot":"{\"auth_id\":\"[REDACTED]\",\"base_url\":\"https://rerun-test.atlassian.net\",\"crawl_config\":{\"concurrency\":1,\"follow_links\":false,\"max_depth\":1,\"max_pages\":5,\"rate_limit\":1000},\"created_at\":\"2025-10-23T12:07:18+11:00\",\"enabled\":true,\"filters\":null,\"id\":\"test-source-rerun-1\",\"name\":\"Test Source for Rerun\",\"type\":\"confluence\",\"updated_at\":\"2025-10-23T12:07:18+11:00\"}","auth_snapshot":"","refresh_source":true,"status":"running","progress":{"total_urls":1,"completed_urls":0,"failed_urls":0,"pending_urls":1,"current_url":"https://rerun-test.atlassian.net","percentage":0,"start_time":"2025-10-23T12:07:18.3117316+11:00","estimated_completion":"0001-01-01T00:00:00Z"},"created_at":"2025-10-23T12:07:18.3117316+11:00","started_at":"2025-10-23T12:07:18.3127575+11:00","completed_at":"0001-01-01T00:00:00Z","result_count":0,"failed_count":0,"documents_saved":0,"seed_urls":["https://rerun-test.atlassian.net"]}
    helpers.go:48: GET http://localhost:8085/api/jobs/2562ca09-d66d-4942-9fbc-ef8ce0ea3c16
    helpers.go:127: Response body: {"id":"2562ca09-d66d-4942-9fbc-ef8ce0ea3c16","name":"","description":"","source_type":"confluence","entity_type":"spaces","config":{"max_depth":1,"max_pages":5,"concurrency":1,"rate_limit":1000000000,"retry_attempts":3,"retry_backoff":2000000000,"include_patterns":[],"exclude_patterns":[],"follow_links":false,"detail_level":"full"},"source_config_snapshot":"{\"auth_id\":\"[REDACTED]\",\"base_url\":\"https://rerun-test.atlassian.net\",\"crawl_config\":{\"concurrency\":1,\"follow_links\":false,\"max_depth\":1,\"max_pages\":5,\"rate_limit\":1000},\"created_at\":\"2025-10-23T12:07:18+11:00\",\"enabled\":true,\"filters\":null,\"id\":\"test-source-rerun-1\",\"name\":\"Test Source for Rerun\",\"type\":\"confluence\",\"updated_at\":\"2025-10-23T12:07:18+11:00\"}","auth_snapshot":"","refresh_source":true,"status":"running","progress":{"total_urls":1,"completed_urls":0,"failed_urls":0,"pending_urls":1,"current_url":"https://rerun-test.atlassian.net","percentage":0,"start_time":"2025-10-23T12:07:18.3117316+11:00","estimated_completion":"0001-01-01T00:00:00Z"},"created_at":"2025-10-23T12:07:18.3117316+11:00","started_at":"2025-10-23T12:07:18.3127575+11:00","completed_at":"0001-01-01T00:00:00Z","result_count":0,"failed_count":0,"documents_saved":0,"seed_urls":["https://rerun-test.atlassian.net"]}
    helpers.go:48: GET http://localhost:8085/api/jobs/2562ca09-d66d-4942-9fbc-ef8ce0ea3c16
    helpers.go:127: Response body: {"id":"2562ca09-d66d-4942-9fbc-ef8ce0ea3c16","name":"","description":"","source_type":"confluence","entity_type":"spaces","config":{"max_depth":1,"max_pages":5,"concurrency":1,"rate_limit":1000000000,"retry_attempts":3,"retry_backoff":2000000000,"include_patterns":[],"exclude_patterns":[],"follow_links":false,"detail_level":"full"},"source_config_snapshot":"{\"auth_id\":\"[REDACTED]\",\"base_url\":\"https://rerun-test.atlassian.net\",\"crawl_config\":{\"concurrency\":1,\"follow_links\":false,\"max_depth\":1,\"max_pages\":5,\"rate_limit\":1000},\"created_at\":\"2025-10-23T12:07:18+11:00\",\"enabled\":true,\"filters\":null,\"id\":\"test-source-rerun-1\",\"name\":\"Test Source for Rerun\",\"type\":\"confluence\",\"updated_at\":\"2025-10-23T12:07:18+11:00\"}","auth_snapshot":"","refresh_source":true,"status":"running","progress":{"total_urls":1,"completed_urls":0,"failed_urls":1,"pending_urls":0,"current_url":"https://rerun-test.atlassian.net","percentage":100,"start_time":"2025-10-23T12:07:18.3117316+11:00","estimated_completion":"0001-01-01T00:00:00Z"},"created_at":"2025-10-23T12:07:18.3117316+11:00","started_at":"2025-10-23T12:07:18.3127575+11:00","completed_at":"0001-01-01T00:00:00Z","result_count":0,"failed_count":0,"documents_saved":0,"seed_urls":["https://rerun-test.atlassian.net"]}
    helpers.go:48: GET http://localhost:8085/api/jobs/2562ca09-d66d-4942-9fbc-ef8ce0ea3c16
    helpers.go:127: Response body: {"id":"2562ca09-d66d-4942-9fbc-ef8ce0ea3c16","name":"","description":"","source_type":"confluence","entity_type":"spaces","config":{"max_depth":1,"max_pages":5,"concurrency":1,"rate_limit":1000000000,"retry_attempts":3,"retry_backoff":2000000000,"include_patterns":[],"exclude_patterns":[],"follow_links":false,"detail_level":"full"},"source_config_snapshot":"{\"auth_id\":\"[REDACTED]\",\"base_url\":\"https://rerun-test.atlassian.net\",\"crawl_config\":{\"concurrency\":1,\"follow_links\":false,\"max_depth\":1,\"max_pages\":5,\"rate_limit\":1000},\"created_at\":\"2025-10-23T12:07:18+11:00\",\"enabled\":true,\"filters\":null,\"id\":\"test-source-rerun-1\",\"name\":\"Test Source for Rerun\",\"type\":\"confluence\",\"updated_at\":\"2025-10-23T12:07:18+11:00\"}","auth_snapshot":"","refresh_source":true,"status":"completed","progress":{"total_urls":1,"completed_urls":0,"failed_urls":1,"pending_urls":0,"current_url":"https://rerun-test.atlassian.net","percentage":100,"start_time":"2025-10-23T12:07:18.3117316+11:00","estimated_completion":"0001-01-01T00:00:00Z"},"created_at":"2025-10-23T12:07:18+11:00","started_at":"2025-10-23T12:07:18+11:00","completed_at":"2025-10-23T12:07:22+11:00","result_count":0,"failed_count":1,"documents_saved":0,"seed_urls":["https://rerun-test.atlassian.net"]}
    job_rerun_test.go:147: Job finished with status: completed
    job_rerun_test.go:161: Testing rerun functionality (core requirement)...
    helpers.go:55: POST http://localhost:8085/api/jobs/2562ca09-d66d-4942-9fbc-ef8ce0ea3c16/rerun
    helpers.go:127: Response body: {"message":"Job copied and added to queue successfully","new_job_id":"","original_job_id":"2562ca09-d66d-4942-9fbc-ef8ce0ea3c16"}
    job_rerun_test.go:183: REQUIREMENT FAILED: Rerun should return new_job_id
    helpers.go:101: DELETE http://localhost:8085/api/jobs/2562ca09-d66d-4942-9fbc-ef8ce0ea3c16
    helpers.go:101: DELETE http://localhost:8085/api/job-definitions/test-job-rerun-def-1
    helpers.go:101: DELETE http://localhost:8085/api/sources/test-source-rerun-1
--- FAIL: TestJobRerun (5.54s)
FAIL
FAIL	github.com/ternarybob/quaero/test/api	6.468s
FAIL
