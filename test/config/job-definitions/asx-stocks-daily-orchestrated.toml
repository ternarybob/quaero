# ASX Stocks Daily Analysis - Orchestrated Version (Test Config)
# =========================================================================
# Test configuration with minimal stocks for faster test execution.
# =========================================================================

id = "asx-stocks-daily-orchestrated"
name = "ASX Daily Stock Analysis (Thinking)"
type = "orchestrator"
description = "AI-powered stock analysis using dynamic planning and execution"
tags = ["asx", "stocks", "daily", "orchestrator", "thinking"]
schedule = ""
timeout = "2h"
enabled = true
auto_start = false

# =========================================================================
# Orchestrator Configuration
# =========================================================================

# Test variables - minimal set for faster test execution
[config]
variables = [
    { ticker = "GNP", name = "GenusPlus Group Ltd", industry = "infrastructure" },
    { ticker = "SKS", name = "SKS Technologies Group", industry = "technology-infrastructure" },
]

# =========================================================================
# Orchestrator Step - Dynamic Planning and Execution
# =========================================================================

[step.analyze_stocks]
type = "orchestrator"
description = "AI-powered stock analysis with dynamic planning"
on_error = "continue"

goal = """
Perform a comprehensive daily analysis of all ASX stocks in the variables list.

For EACH stock in the list:
1. Collect current market data (prices, volume, technical indicators)
2. Fetch recent ASX announcements
3. Search for financial news and analyst coverage
4. Analyze announcements for signal vs noise
5. Generate a stock summary with key metrics
6. Create a BUY/SELL/HOLD recommendation with conviction score

If data collection fails for any stock:
- Note the failure explicitly
- Attempt alternative data sources (web search)
- Continue with remaining stocks

Final output should include:
- Individual stock reports
- Summary table of all recommendations
- Any alerts for significant price movements or announcements
"""

thinking_level = "HIGH"
model_preference = "auto"

available_tools = [
    { name = "fetch_stock_data", description = "Fetch ASX stock prices and technical indicators", worker = "asx_stock_data" },
    { name = "fetch_announcements", description = "Fetch ASX company announcements", worker = "asx_announcements" },
    { name = "search_web", description = "Search web for financial news", worker = "web_search" },
    { name = "analyze_summary", description = "Generate LLM-based analysis summary", worker = "summary" },
    { name = "run_stock_review", description = "Execute stock review template", worker = "job_template", template = "asx-stock-review" },
    { name = "run_data_collection", description = "Execute data collection template", worker = "job_template", template = "asx-stock-data" }
]

# Output tags - allows email step to find this document via body_from_tag
output_tags = ["stock-recommendation"]

# =========================================================================
# Email Step - Send consolidated report
# =========================================================================

[step.email_report]
type = "email"
description = "Email consolidated stock analysis report"
depends = "analyze_stocks"
on_error = "fail"
to = "bobmcallan@gmail.com"
subject = "ASX Daily Stock Analysis - AI-Powered Report"
body_from_tag = "stock-recommendation"
