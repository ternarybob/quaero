# Codebase Assessment Pipeline - Language Agnostic
id = "codebase_assess"
name = "Codebase Assessment Pipeline"
type = "custom"
description = "Comprehensive codebase analysis producing index, summary, and map"
tags = ["assessment", "any-language"]
timeout = "4h"
enabled = true
auto_start = false

# PHASE 1: IMPORT & INDEX (Parallel)

[step.code_map]
type = "code_map"
description = "Build hierarchical code structure map"
project_name = "test-project"
dir_path = "../fixtures/multi_lang_project"
max_depth = 15
skip_summarization = true

[step.import_files]
type = "local_dir"
description = "Import codebase files as documents"
dir_path = "../fixtures/multi_lang_project"
tags = ["codebase", "test-project"]
extensions = [".go", ".py", ".js", ".ts", ".java", ".rs", ".c", ".cpp", ".h", ".hpp", ".rb", ".php", ".cs", ".swift", ".kt", ".scala", ".md", ".txt", ".toml", ".yaml", ".yml", ".json"]
exclude_paths = [".git", "node_modules", "vendor", "__pycache__", "dist", "build", "target", ".venv"]
max_file_size = 1048576

# PHASE 2: ANALYSIS (Depends on Phase 1)

[step.classify_files]
type = "agent"
description = "Rule-based classification of file purpose and role"
depends = "import_files"
agent_type = "rule_classifier"
batch_mode = true
filter_tags = ["codebase", "test-project"]

[step.extract_build_info]
type = "agent"
description = "Extract how to build, run, and test the project"
depends = "import_files"
agent_type = "metadata_enricher"
batch_mode = true
filter_tags = ["codebase", "test-project"]
filter_limit = 50
filter_category = ["build", "config", "docs"]

[step.identify_components]
type = "agent"
description = "Identify major components and entry points"
depends = "classify_files"
agent_type = "entity_recognizer"
batch_mode = true
filter_tags = ["codebase", "test-project"]
filter_limit = 100
filter_category = ["source", "config"]

# PHASE 3: SYNTHESIS (Depends on Phase 2)

[step.build_graph]
type = "dependency_graph"
description = "Build file dependency graph from analysis"
depends = "identify_components"
filter_tags = ["codebase", "test-project"]

[step.generate_index]
type = "summary"
description = "Generate codebase index document"
depends = "classify_files, code_map"
filter_tags = ["codebase", "test-project"]
filter_limit = 200
api_key = "{google_gemini_api_key}"
prompt = """Create a comprehensive INDEX of this codebase. For each file:
- File path
- Purpose (one line)
- Key exports/functions
- Related files

Organize by directory. Make it searchable."""

[step.generate_summary]
type = "summary"
description = "Generate codebase summary document"
depends = "extract_build_info, identify_components"
filter_tags = ["codebase", "test-project"]
filter_limit = 150
api_key = "{google_gemini_api_key}"
prompt = """Create a comprehensive SUMMARY of this codebase covering:

1. OVERVIEW: What does this project do? (2-3 sentences)
2. ARCHITECTURE: Key components and how they interact
3. BUILD: How to build the project (exact commands)
4. RUN: How to run the project
5. TEST: How to run tests
6. KEY FILES: Most important files to understand first
7. DEPENDENCIES: External libraries and tools needed"""

[step.generate_map]
type = "summary"
description = "Generate codebase map document"
depends = "code_map, build_graph"
filter_tags = ["codebase", "test-project"]
filter_limit = 100
api_key = "{google_gemini_api_key}"
prompt = """Create a structural MAP of this codebase:

1. DIRECTORY TREE: Show folder structure with purpose annotations
2. COMPONENT DIAGRAM: Major components and their relationships
3. DATA FLOW: How data moves through the system
4. ENTRY POINTS: Where execution starts
5. EXTENSION POINTS: Where to add new functionality"""

[error_tolerance]
max_child_failures = 50
failure_action = "continue"
