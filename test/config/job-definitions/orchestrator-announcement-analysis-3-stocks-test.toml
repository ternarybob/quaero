# Orchestrator Test: Announcement Signal Analysis - 3 Stocks
# =========================================================================
# Tests the multi-stock announcement signal-to-noise analysis workflow.
# Uses the announcement-analysis-report template for consolidated output.
# Output is ordered alphabetically by ticker.
#
# WORKFLOW:
# 1. Data Collection: ASX Announcements Worker (per ticker)
# 2. Signal Analysis: SummaryWorker with announcement-analysis-report template
# 3. Email Report: Send consolidated analysis
#
# TEMPLATE: internal/templates/announcement-analysis-report.toml (embedded)
# SCHEMA: internal/schemas/announcement-analysis-report.schema.json
# OUTPUT TAG: announcement-analysis-report
# =========================================================================

# =========================================================================
# Job Definition (MUST be at root level before any [section])
# =========================================================================
id = "orchestrator-announcement-analysis-3-stocks-test"
name = "Test: Announcement Signal Analysis (3 Stocks)"
type = "orchestrator"
description = "Integration test for multi-stock announcement signal analysis with alphabetical ordering"
tags = ["test", "orchestrator", "announcement-analysis", "signal-noise", "multi-stock"]
schedule = ""
timeout = "2h"
enabled = true
auto_start = false

# =========================================================================
# META (documentation only, not parsed)
# =========================================================================
[meta]
author = "Claude Code"
version = "1.0"
created = "2026-01-04"
purpose = "Integration test for multi-stock announcement analysis with alphabetical ticker ordering"

# =========================================================================
# Test Configuration - Three Stocks
# =========================================================================

[config]
variables = [
    { ticker = "ASX:GNP", portfolio = "trading" },
    { ticker = "ASX:SKS", portfolio = "trading" },
    { ticker = "ASX:WEB", portfolio = "smsf" },
]

# =========================================================================
# Step 1: Collect Announcements (Deterministic)
# =========================================================================

[step.collect_announcements]
type = "asx_announcements"
description = "Collect ASX announcements for all tickers"
on_error = "fail"

# =========================================================================
# Step 2: Signal Analysis (AI with Schema - Multi-Stock)
# =========================================================================

[step.analyze_signals]
type = "summary"
description = "Analyze announcements for signal-to-noise quality (all stocks, alphabetical)"
depends = "collect_announcements"
on_error = "fail"
template = "announcement-analysis-report"
filter_tags = ["asx-announcement-summary"]
output_tags = ["announcement-analysis-report"]

# =========================================================================
# Step 3: Email Report
# =========================================================================

[step.email_report]
type = "email"
description = "Email consolidated announcement analysis report"
depends = "analyze_signals"
always_run = true
on_error = "fail"
to = "bobmcallan@gmail.com"
subject = "Announcement Signal Analysis Test - 3 Stocks"
body_from_tag = "announcement-analysis-report"
