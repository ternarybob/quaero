# Orchestrator Worker Test
# =========================================================================
# Integration test for hybrid orchestrator workflow with stock analysis.
# Tests the full workflow:
# 1. Data Collection: StockDataCollectionWorker (deterministic)
# 2. Stock Analysis: SummaryWorker with stock-analysis template
#
# TEMPLATE: internal/templates/stock-analysis.toml (embedded)
# OUTPUT TAG: stock-analysis
# TICKER: ASX:GNP (known to have good data coverage)
# =========================================================================

# =========================================================================
# Job Definition (MUST be at root level before any [section])
# =========================================================================
id = "orchestrator-worker-test"
name = "Orchestrator Worker Test"
type = "orchestrator"
description = "API integration test for hybrid orchestrator workflow"
tags = ["test", "orchestrator", "stock-analysis", "hybrid"]
schedule = ""
timeout = "30m"
enabled = true
auto_start = false

# =========================================================================
# META (documentation only, not parsed)
# =========================================================================
[meta]
author = "Claude Code"
version = "2.0"
created = "2026-01-03"
updated = "2026-01-03"
purpose = "API integration test for hybrid orchestrator workflow"

# =========================================================================
# Test Configuration - Single Stock for Fast Testing
# =========================================================================

[config]
variables = [
    { ticker = "ASX:GNP", portfolio = "test" },
]

benchmarks = [
    { code = "XJO", name = "S&P/ASX 200" },
]

# =========================================================================
# Step 1: Data Collection (Deterministic)
# =========================================================================

[step.collect_data]
type = "stock_data_collection"
description = "Collect stock data for single ticker"
on_error = "fail"

# =========================================================================
# Step 2: Stock Analysis (AI)
# =========================================================================

[step.analyze]
type = "summary"
description = "Analyze collected stock data"
depends = "collect_data"
on_error = "fail"
template = "stock-analysis"
filter_tags = ["stock-data-collected"]
output_tags = ["stock-analysis"]
