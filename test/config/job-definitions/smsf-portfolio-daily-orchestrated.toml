# SMSF Portfolio Review - Orchestrated Version (Test Config)
# =========================================================================
# Test configuration with minimal holdings for faster test execution.
# =========================================================================

id = "smsf-portfolio-daily-orchestrated"
name = "SMSF Portfolio Strategy Review (Thinking)"
type = "orchestrator"
description = "AI-powered SMSF portfolio analysis with strategic reasoning"
tags = ["smsf", "portfolio", "daily", "orchestrator", "thinking"]
schedule = ""
timeout = "3h"
enabled = true
auto_start = false

# =========================================================================
# Orchestrator Configuration
# =========================================================================

# Test variables - minimal holdings for faster test execution
[config]
variables = [
    { ticker = "GNP", name = "GenusPlus Group Ltd", industry = "infrastructure", units = 1000, avg_price = 5.00, weighting = 50.0 },
    { ticker = "SKS", name = "SKS Technologies Group", industry = "technology-infrastructure", units = 500, avg_price = 4.00, weighting = 50.0 },
]

benchmarks = [
    { code = "XJO", name = "S&P/ASX 200" },
]

# =========================================================================
# Orchestrator Step - Strategic Portfolio Review
# =========================================================================

[step.strategic_review]
type = "orchestrator"
description = "AI-powered strategic portfolio review"
on_error = "continue"

goal = """
Perform a comprehensive SMSF portfolio review for all holdings in the variables list.

PORTFOLIO CONTEXT:
Read the portfolio holdings from the variables. Each holding includes:
- Ticker, company name, industry
- Units held, average purchase price, portfolio weighting

ANALYSIS TASKS:
1. For each holding, calculate current valuation and P/L:
   - Fetch current market price
   - Calculate: Current Value = Units × Current Price
   - Calculate: Total Return = Current Value - (Units × Avg Price)
   - Calculate: Return % = Total Return / Cost Basis

2. Collect benchmark data:
   - Fetch ASX 200 (XJO) performance for comparison
   - Fetch Small Ords (XSO) for small cap comparison

3. For each holding, perform stock analysis:
   - Technical trend analysis (SMA 50, SMA 200, RSI)
   - Announcement quality assessment (signal vs noise)
   - Industry outlook
   - Competitor comparison

4. Generate portfolio-level insights:
   - Identify top performers and laggards
   - Check for COOKED stocks (overextended, high risk)
   - Identify BUY/SELL/HOLD actions with conviction scores
   - SMSF compliance considerations

5. Create consolidated portfolio summary:
   - Gain/Loss table with all holdings
   - Consolidated recommendations table
   - Priority actions by timeframe (Trader 1-8 weeks, Super 6m-3y)
   - Opportunity analysis for next 6 months

If data is missing for any stock:
- Calculate what you can with available data
- Note missing data explicitly
- Suggest alternative data sources

OUTPUT REQUIREMENTS:
- Portfolio valuation summary with total gains/losses
- Individual stock BUY/SELL/HOLD recommendations
- Risk alerts for overextended positions
- Actionable next steps
"""

thinking_level = "HIGH"
model_preference = "auto"

available_tools = [
    { name = "fetch_stock_data", description = "Fetch ASX stock prices and technicals", worker = "asx_stock_data" },
    { name = "fetch_announcements", description = "Fetch ASX company announcements", worker = "asx_announcements" },
    { name = "fetch_index_data", description = "Fetch ASX index data for benchmarks", worker = "asx_index_data" },
    { name = "search_web", description = "Search for financial news and analysis", worker = "web_search" },
    { name = "analyze_summary", description = "Generate LLM-based analysis", worker = "summary" },
    { name = "run_stock_review", description = "Execute stock review template", worker = "job_template", template = "asx-stock-review" },
    { name = "run_data_collection", description = "Execute data collection template", worker = "job_template", template = "asx-stock-data" },
    { name = "run_portfolio_summary", description = "Execute portfolio summary template", worker = "job_template", template = "smsf-portfolio-summary" }
]

# Output tags - allows email step to find this document via body_from_tag
output_tags = ["smsf-portfolio-review"]

# =========================================================================
# Email Step - Send Portfolio Report
# =========================================================================

[step.email_portfolio]
type = "email"
description = "Email consolidated SMSF portfolio review"
depends = "strategic_review"
on_error = "fail"
to = "bobmcallan@gmail.com"
subject = "SMSF Portfolio Review - AI-Powered Strategic Analysis"
body_from_tag = "smsf-portfolio-review"
